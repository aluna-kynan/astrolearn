{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/deadline-2days/space-quiz-mission%20-%20Final%20-%20Copy%20%287%29%20-%20Copy/lib/data.ts"],"sourcesContent":["// Type Definitions\r\n\r\nexport type DifficultyLevel = 'easy' | 'medium' | 'hard';\r\nexport type WeaponType = 'spread' | 'laser' | 'magnetic';\r\n\r\nexport interface QuizQuestion {\r\n    id: number;\r\n    difficulty: DifficultyLevel;\r\n    question: string;\r\n    options: string[];\r\n    correctAnswer: number;\r\n}\r\n\r\nexport interface Spaceship {\r\n    id: number;\r\n    name: string;\r\n    description: string;\r\n    speed: number;\r\n    color: string;\r\n    emoji: string;\r\n    image: string;\r\n}\r\n\r\n// Weapon Configuration\r\nexport interface WeaponConfig {\r\n    type: WeaponType;\r\n    fireRate: number; // ms between shots\r\n    bulletSpeed: number;\r\n    bulletWidth: number;\r\n    bulletHeight: number;\r\n    damage: number;\r\n    color: string;\r\n    spreadCount?: number; // for spread shot\r\n    isAutoFire?: boolean; // continuous firing\r\n}\r\n\r\n// Difficulty Configuration for Mini-Game\r\nexport interface DifficultyConfig {\r\n    weapon: WeaponConfig;\r\n    asteroidHP: number;\r\n    asteroidSize: { min: number; max: number };\r\n    asteroidSpeed: { min: number; max: number };\r\n    asteroidSpawnRate: number; // ms between spawns\r\n    totalAsteroids: number;\r\n    hasBoss: boolean;\r\n    bossHP: number;\r\n    bossSize: number;\r\n    gameDuration: number; // seconds\r\n}\r\n\r\n// Difficulty Configurations\r\nexport const difficultyConfigs: Record<DifficultyLevel, DifficultyConfig> = {\r\n    easy: {\r\n        weapon: {\r\n            type: 'spread',\r\n            fireRate: 200,\r\n            bulletSpeed: 10,\r\n            bulletWidth: 6,\r\n            bulletHeight: 15,\r\n            damage: 80, // Updated damage\r\n            color: '#ff6b6b',\r\n            spreadCount: 3,\r\n            isAutoFire: true\r\n        },\r\n        asteroidHP: 1,\r\n        asteroidSize: { min: 25, max: 35 },\r\n        asteroidSpeed: { min: 1, max: 2 }, // Slower\r\n        asteroidSpawnRate: 1500, // Slower spawn - sparse meteors\r\n        totalAsteroids: 12, // Fewer meteors\r\n        hasBoss: false,\r\n        bossHP: 0,\r\n        bossSize: 0,\r\n        gameDuration: 30\r\n    },\r\n    medium: {\r\n        weapon: {\r\n            type: 'laser',\r\n            fireRate: 50,\r\n            bulletSpeed: 15,\r\n            bulletWidth: 8,\r\n            bulletHeight: 40,\r\n            damage: 100, // Updated damage\r\n            color: '#00d4ff',\r\n            isAutoFire: true\r\n        },\r\n        asteroidHP: 2,\r\n        asteroidSize: { min: 30, max: 45 },\r\n        asteroidSpeed: { min: 2, max: 3.5 },\r\n        asteroidSpawnRate: 900, // Moderate spawn\r\n        totalAsteroids: 20, // Moderate meteors\r\n        hasBoss: false,\r\n        bossHP: 0,\r\n        bossSize: 0,\r\n        gameDuration: 40\r\n    },\r\n    hard: {\r\n        weapon: {\r\n            type: 'magnetic',\r\n            fireRate: 150,\r\n            bulletSpeed: 8,\r\n            bulletWidth: 10,\r\n            bulletHeight: 20,\r\n            damage: 50, // Updated damage\r\n            color: '#9d4edd',\r\n            isAutoFire: true\r\n        },\r\n        asteroidHP: 2,\r\n        asteroidSize: { min: 25, max: 40 },\r\n        asteroidSpeed: { min: 2.5, max: 4.5 }, // Faster\r\n        asteroidSpawnRate: 500, // Fast spawn - meteor rain\r\n        totalAsteroids: 35, // Dense meteor field\r\n        hasBoss: true,\r\n        bossHP: 100,\r\n        bossSize: 120,\r\n        gameDuration: 50\r\n    }\r\n};\r\n\r\nexport type QuizQuestionsMap = Record<DifficultyLevel, QuizQuestion[]>;\r\n\r\n// Quiz Questions Database\r\nexport const quizQuestions: QuizQuestionsMap = {\r\n    easy: [\r\n        {\r\n            id: 1,\r\n            difficulty: \"easy\",\r\n            question: \"What is the closest planet to the Sun?\",\r\n            options: [\"Mercury\", \"Venus\", \"Earth\", \"Mars\"],\r\n            correctAnswer: 0\r\n        },\r\n        {\r\n            id: 2,\r\n            difficulty: \"easy\",\r\n            question: \"How many planets are in our solar system?\",\r\n            options: [\"7\", \"8\", \"9\", \"10\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 3,\r\n            difficulty: \"easy\",\r\n            question: \"What is the largest planet in our solar system?\",\r\n            options: [\"Saturn\", \"Neptune\", \"Jupiter\", \"Uranus\"],\r\n            correctAnswer: 2\r\n        },\r\n        {\r\n            id: 4,\r\n            difficulty: \"easy\",\r\n            question: \"What is Earth's natural satellite called?\",\r\n            options: [\"The Moon\", \"Titan\", \"Europa\", \"Phobos\"],\r\n            correctAnswer: 0\r\n        },\r\n        {\r\n            id: 5,\r\n            difficulty: \"easy\",\r\n            question: \"Which planet is known as the Red Planet?\",\r\n            options: [\"Venus\", \"Mars\", \"Jupiter\", \"Saturn\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 6,\r\n            difficulty: \"easy\",\r\n            question: \"What is the name of our galaxy?\",\r\n            options: [\"Andromeda\", \"Milky Way\", \"Triangulum\", \"Whirlpool\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 7,\r\n            difficulty: \"easy\",\r\n            question: \"What is the Sun?\",\r\n            options: [\"A planet\", \"A moon\", \"A star\", \"An asteroid\"],\r\n            correctAnswer: 2\r\n        },\r\n        {\r\n            id: 8,\r\n            difficulty: \"easy\",\r\n            question: \"Which planet has rings?\",\r\n            options: [\"Mars\", \"Venus\", \"Saturn\", \"Mercury\"],\r\n            correctAnswer: 2\r\n        },\r\n        {\r\n            id: 9,\r\n            difficulty: \"easy\",\r\n            question: \"How long does it take Earth to orbit the Sun?\",\r\n            options: [\"365 days\", \"30 days\", \"7 days\", \"100 days\"],\r\n            correctAnswer: 0\r\n        },\r\n        {\r\n            id: 10,\r\n            difficulty: \"easy\",\r\n            question: \"What is the smallest planet in our solar system?\",\r\n            options: [\"Mars\", \"Mercury\", \"Venus\", \"Pluto\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 11,\r\n            difficulty: \"easy\",\r\n            question: \"Which planet is closest to Earth?\",\r\n            options: [\"Mars\", \"Venus\", \"Mercury\", \"Jupiter\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 12,\r\n            difficulty: \"easy\",\r\n            question: \"What color is the sunset on Mars?\",\r\n            options: [\"Red\", \"Orange\", \"Blue\", \"Purple\"],\r\n            correctAnswer: 2\r\n        },\r\n        {\r\n            id: 13,\r\n            difficulty: \"easy\",\r\n            question: \"How many moons does Earth have?\",\r\n            options: [\"0\", \"1\", \"2\", \"3\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 14,\r\n            difficulty: \"easy\",\r\n            question: \"What is the hottest planet in our solar system?\",\r\n            options: [\"Mercury\", \"Venus\", \"Mars\", \"Jupiter\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 15,\r\n            difficulty: \"easy\",\r\n            question: \"What do we call a person who travels to space?\",\r\n            options: [\"Pilot\", \"Astronaut\", \"Captain\", \"Navigator\"],\r\n            correctAnswer: 1\r\n        }\r\n    ],\r\n    medium: [\r\n        {\r\n            id: 16,\r\n            difficulty: \"medium\",\r\n            question: \"What is the Great Red Spot on Jupiter?\",\r\n            options: [\"A volcano\", \"A storm\", \"A crater\", \"An ocean\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 17,\r\n            difficulty: \"medium\",\r\n            question: \"Which planet has the most moons?\",\r\n            options: [\"Jupiter\", \"Saturn\", \"Uranus\", \"Neptune\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 18,\r\n            difficulty: \"medium\",\r\n            question: \"What is the Kuiper Belt?\",\r\n            options: [\"A region of asteroids\", \"A region of comets and icy bodies\", \"A type of galaxy\", \"A constellation\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 19,\r\n            difficulty: \"medium\",\r\n            question: \"How long is a day on Venus?\",\r\n            options: [\"24 hours\", \"243 Earth days\", \"10 hours\", \"365 days\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 20,\r\n            difficulty: \"medium\",\r\n            question: \"What is the name of the first artificial satellite?\",\r\n            options: [\"Apollo 11\", \"Sputnik 1\", \"Voyager 1\", \"Hubble\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 21,\r\n            difficulty: \"medium\",\r\n            question: \"Which planet rotates on its side?\",\r\n            options: [\"Neptune\", \"Saturn\", \"Uranus\", \"Jupiter\"],\r\n            correctAnswer: 2\r\n        },\r\n        {\r\n            id: 22,\r\n            difficulty: \"medium\",\r\n            question: \"What is the asteroid belt located between?\",\r\n            options: [\"Earth and Mars\", \"Mars and Jupiter\", \"Jupiter and Saturn\", \"Venus and Earth\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 23,\r\n            difficulty: \"medium\",\r\n            question: \"What is the speed of light?\",\r\n            options: [\"300,000 km/s\", \"150,000 km/s\", \"500,000 km/s\", \"100,000 km/s\"],\r\n            correctAnswer: 0\r\n        },\r\n        {\r\n            id: 24,\r\n            difficulty: \"medium\",\r\n            question: \"Which moon of Jupiter is the largest in the solar system?\",\r\n            options: [\"Europa\", \"Io\", \"Ganymede\", \"Callisto\"],\r\n            correctAnswer: 2\r\n        },\r\n        {\r\n            id: 25,\r\n            difficulty: \"medium\",\r\n            question: \"What causes the Northern Lights (Aurora Borealis)?\",\r\n            options: [\"Moonlight reflection\", \"Solar wind particles\", \"Meteor showers\", \"Volcanic ash\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 26,\r\n            difficulty: \"medium\",\r\n            question: \"How many Earth years does it take Neptune to orbit the Sun?\",\r\n            options: [\"84 years\", \"165 years\", \"248 years\", \"12 years\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 27,\r\n            difficulty: \"medium\",\r\n            question: \"What is a light-year?\",\r\n            options: [\"A unit of time\", \"A unit of distance\", \"A unit of speed\", \"A unit of mass\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 28,\r\n            difficulty: \"medium\",\r\n            question: \"Which planet has the strongest winds in the solar system?\",\r\n            options: [\"Jupiter\", \"Saturn\", \"Neptune\", \"Uranus\"],\r\n            correctAnswer: 2\r\n        },\r\n        {\r\n            id: 29,\r\n            difficulty: \"medium\",\r\n            question: \"What is the temperature at the core of the Sun?\",\r\n            options: [\"1 million Â°C\", \"15 million Â°C\", \"100,000 Â°C\", \"50 million Â°C\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 30,\r\n            difficulty: \"medium\",\r\n            question: \"Which spacecraft was the first to leave our solar system?\",\r\n            options: [\"Voyager 1\", \"Pioneer 10\", \"New Horizons\", \"Cassini\"],\r\n            correctAnswer: 0\r\n        }\r\n    ],\r\n    hard: [\r\n        {\r\n            id: 31,\r\n            difficulty: \"hard\",\r\n            question: \"What is the Schwarzschild radius?\",\r\n            options: [\"The radius of a star\", \"The event horizon of a black hole\", \"The distance to the nearest star\", \"The size of a galaxy\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 32,\r\n            difficulty: \"hard\",\r\n            question: \"What percentage of the universe is dark matter?\",\r\n            options: [\"27%\", \"68%\", \"5%\", \"15%\"],\r\n            correctAnswer: 0\r\n        },\r\n        {\r\n            id: 33,\r\n            difficulty: \"hard\",\r\n            question: \"What is the Chandrasekhar limit?\",\r\n            options: [\"Maximum mass of a white dwarf\", \"Speed of light limit\", \"Temperature of stars\", \"Size of galaxies\"],\r\n            correctAnswer: 0\r\n        },\r\n        {\r\n            id: 34,\r\n            difficulty: \"hard\",\r\n            question: \"What is gravitational lensing?\",\r\n            options: [\"Bending of light by gravity\", \"Formation of galaxies\", \"Expansion of universe\", \"Collision of stars\"],\r\n            correctAnswer: 0\r\n        },\r\n        {\r\n            id: 35,\r\n            difficulty: \"hard\",\r\n            question: \"What is the Roche limit?\",\r\n            options: [\"Distance where tidal forces destroy objects\", \"Maximum speed in space\", \"Temperature of black holes\", \"Age of universe\"],\r\n            correctAnswer: 0\r\n        },\r\n        {\r\n            id: 36,\r\n            difficulty: \"hard\",\r\n            question: \"What is redshift in astronomy?\",\r\n            options: [\"Color of Mars\", \"Light stretched by expansion\", \"Type of star\", \"Solar phenomenon\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 37,\r\n            difficulty: \"hard\",\r\n            question: \"What is the Oort Cloud?\",\r\n            options: [\"A nebula\", \"A theoretical cloud of comets\", \"A type of galaxy\", \"A constellation\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 38,\r\n            difficulty: \"hard\",\r\n            question: \"What is Hawking radiation?\",\r\n            options: [\"Radiation from the Sun\", \"Theoretical radiation from black holes\", \"Cosmic background radiation\", \"Solar wind\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 39,\r\n            difficulty: \"hard\",\r\n            question: \"What is the cosmic microwave background?\",\r\n            options: [\"Radiation from stars\", \"Afterglow of the Big Bang\", \"Solar radiation\", \"Galaxy emissions\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 40,\r\n            difficulty: \"hard\",\r\n            question: \"What is a quasar?\",\r\n            options: [\"A type of star\", \"An extremely bright active galactic nucleus\", \"A planet\", \"A moon\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 41,\r\n            difficulty: \"hard\",\r\n            question: \"What is the Hubble constant?\",\r\n            options: [\"Age of universe\", \"Rate of universe expansion\", \"Speed of light\", \"Mass of galaxies\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 42,\r\n            difficulty: \"hard\",\r\n            question: \"What are magnetars?\",\r\n            options: [\"Magnetic planets\", \"Neutron stars with extreme magnetic fields\", \"Black holes\", \"Asteroids\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 43,\r\n            difficulty: \"hard\",\r\n            question: \"What is the Drake equation used for?\",\r\n            options: [\"Calculating star mass\", \"Estimating alien civilizations\", \"Measuring distances\", \"Predicting eclipses\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 44,\r\n            difficulty: \"hard\",\r\n            question: \"What is a pulsar?\",\r\n            options: [\"A pulsating star\", \"A rotating neutron star\", \"A type of galaxy\", \"A comet\"],\r\n            correctAnswer: 1\r\n        },\r\n        {\r\n            id: 45,\r\n            difficulty: \"hard\",\r\n            question: \"What is the Great Attractor?\",\r\n            options: [\"A black hole\", \"A gravitational anomaly pulling galaxies\", \"A supernova\", \"A nebula\"],\r\n            correctAnswer: 1\r\n        }\r\n    ]\r\n};\r\n\r\n// Spaceship Database\r\nexport const spaceships: Spaceship[] = [\r\n    {\r\n        id: 1,\r\n        name: \"Nebula Striker\",\r\n        description: \"Fast and agile fighter craft\",\r\n        speed: 9,\r\n        color: \"#0026ffff\",\r\n        emoji: \"ðŸš€\",\r\n        image: \"/assets/main_4_2_2.png\"\r\n    },\r\n    {\r\n        id: 2,\r\n        name: \"Quantum UFO\",\r\n        description: \"Advanced exploration vessel\",\r\n        speed: 7,\r\n        color: \"#9d4edd\",\r\n        emoji: \"ðŸ›¸\",\r\n        image: \"/assets/galaksi2.webp\"\r\n    },\r\n    {\r\n        id: 3,\r\n        name: \"Stellar Phoenix\",\r\n        description: \"Heavy combat cruiser\",\r\n        speed: 6,\r\n        color: \"#ff006e\",\r\n        emoji: \"ðŸ›°ï¸\",\r\n        image: \"/assets/galaksi3.webp\"\r\n    },\r\n    {\r\n        id: 4,\r\n        name: \"Cosmic Ranger\",\r\n        description: \"Balanced all-purpose ship\",\r\n        speed: 8,\r\n        color: \"#1A5D1A\",\r\n        emoji: \"âœ¨\",\r\n        image: \"/assets/galaksi4.webp\"\r\n    },\r\n    {\r\n        id: 5,\r\n        name: \"Void Reaper\",\r\n        description: \"Stealth reconnaissance craft\",\r\n        speed: 10,\r\n        color: \"#ff9e00\",\r\n        emoji: \"ðŸŒŸ\",\r\n        image: \"/assets/galaksi5.gif\"\r\n    },\r\n    {\r\n        id: 6,\r\n        name: \"Galaxy Titan\",\r\n        description: \"Massive flagship carrier\",\r\n        speed: 5,\r\n        color: \"#FF4646\",\r\n        emoji: \"ðŸŒ \",\r\n        image: \"/assets/galaksi6.png\"\r\n    }\r\n];\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 705, "column": 0}, "map": {"version":3,"sources":["file:///E:/deadline-2days/space-quiz-mission%20-%20Final%20-%20Copy%20%287%29%20-%20Copy/lib/miniGame.ts"],"sourcesContent":["import { Spaceship, DifficultyLevel, DifficultyConfig, WeaponConfig, WeaponType, difficultyConfigs } from './data';\r\n\r\n// ============ TYPE DEFINITIONS ============\r\n\r\ninterface Player {\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n    speed: number;\r\n    image: HTMLImageElement;\r\n    dx: number;\r\n    dy: number;\r\n    hp: number;\r\n    maxHp: number;\r\n    tilt: number;\r\n}\r\n\r\ninterface Bullet {\r\n    id: number;\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n    width: number;\r\n    height: number;\r\n    speed: number;\r\n    damage: number;\r\n    color: string;\r\n    type: 'spread' | 'laser' | 'magnetic';\r\n    targetAsteroid?: MovingAsteroid;\r\n    angle?: number;\r\n    isEnemy?: boolean;\r\n}\r\n\r\n\r\n\r\n// Moving meteors (to destroy)\r\ninterface MovingAsteroid {\r\n    id: number;\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n    baseSize: number;\r\n    speed: number;\r\n    hp: number;\r\n    maxHp: number;\r\n    isBoss: boolean;\r\n    rotation: number;\r\n    rotationSpeed: number;\r\n    hitFlash: number;\r\n    laneX: number;\r\n}\r\n\r\n// Enemy rockets\r\ninterface EnemyRocket {\r\n    id: number;\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n    width: number;\r\n    height: number;\r\n    speed: number;\r\n    hp: number;\r\n    maxHp: number;\r\n    laneX: number;\r\n    lastFireTime: number;\r\n}\r\n\r\n// Boss Rocket (for hard difficulty, appears in last 10 seconds)\r\ninterface BossRocket {\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n    speed: number;\r\n    hp: number;\r\n    maxHp: number;\r\n    lastFireTime: number;\r\n    // 4 turret positions (2 left, 2 right)\r\n    turrets: { offsetX: number; offsetY: number }[];\r\n}\r\n\r\n\r\n\r\ninterface PowerUp {\r\n    id: number;\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n    width: number;\r\n    height: number;\r\n    weaponType: WeaponType;\r\n    color: string;\r\n    rotation: number;\r\n    laneX: number;\r\n}\r\n\r\nexport interface GameStats {\r\n    hits: number;\r\n    asteroidsDestroyed: number;\r\n    bossDestroyed: boolean;\r\n    score: number;\r\n    success: boolean;\r\n    playerHP: number;\r\n    isEliminated: boolean;\r\n}\r\n\r\ntype MiniGameCallback = (stats: GameStats) => void;\r\n\r\n// ============ GAME STATE ============\r\n\r\nlet canvas: HTMLCanvasElement | null = null;\r\nlet ctx: CanvasRenderingContext2D | null = null;\r\nlet player: Player | null = null;\r\nlet bullets: Bullet[] = [];\r\nlet movingAsteroids: MovingAsteroid[] = [];\r\nlet enemyRockets: EnemyRocket[] = [];\r\nlet enemyBullets: Bullet[] = [];\r\nlet bossRocket: BossRocket | null = null;\r\nlet powerUps: PowerUp[] = [];\r\nlet gameLoop: ReturnType<typeof requestAnimationFrame> | null = null;\r\nlet isGameRunning: boolean = false;\r\nlet onComplete: MiniGameCallback | null = null;\r\nlet callbackCalled: boolean = false;\r\n\r\n// Game config\r\nlet difficultyConfig: DifficultyConfig | null = null;\r\nlet weaponConfig: WeaponConfig | null = null;\r\nlet currentWeapon: WeaponType | null = null;\r\nlet hasWeapon: boolean = false;\r\nlet meteorImage: HTMLImageElement | null = null;\r\nlet currentDifficulty: DifficultyLevel = 'easy';\r\n\r\n// Dual weapon system: spread is always base weapon, secondary is from power-up\r\nlet secondaryWeapon: WeaponType | null = null;\r\nlet secondaryWeaponConfig: WeaponConfig | null = null;\r\nlet secondaryWeaponEndTime: number = 0;\r\n\r\n// Background scrolling\r\nlet backgroundImage: HTMLImageElement | null = null;\r\nlet backgroundY1: number = 0;\r\nlet backgroundY2: number = 0;\r\nlet backgroundScrollSpeed: number = 4;\r\n\r\n// Booster decorations\r\nlet boosterImage: HTMLImageElement | null = null;\r\ninterface BoosterDecor { x: number; y: number; scale: number; rotation: number; rotationSpeed: number; }\r\nlet boosterDecors: BoosterDecor[] = [];\r\n\r\n// Smoke particles\r\nlet smokeImage: HTMLImageElement | null = null;\r\ninterface SmokeParticle { x: number; y: number; alpha: number; scale: number; age: number; vx: number; vy: number; }\r\nlet smokeParticles: SmokeParticle[] = [];\r\nlet lastSmokeSpawnTime: number = 0;\r\n\r\n// Enemy rocket image\r\nlet enemyRocketImage: HTMLImageElement | null = null;\r\n\r\n// Explosion particles\r\nlet explosionImage: HTMLImageElement | null = null;\r\ninterface ExplosionParticle { x: number; y: number; scale: number; alpha: number; rotation: number; age: number; }\r\nlet explosionParticles: ExplosionParticle[] = [];\r\n\r\n// Bullet images\r\nlet bulletSpreadImage: HTMLImageElement | null = null;  // bullet_25.png\r\nlet bulletMagneticImage: HTMLImageElement | null = null; // bullet_73_5.png\r\nlet bulletLaserImage: HTMLImageElement | null = null;    // bullet_68.png\r\n\r\n// Boss rocket image\r\nlet bossRocketImage: HTMLImageElement | null = null;\r\nlet bossBulletImage: HTMLImageElement | null = null; // bullet_4_2_0.png\r\n\r\n// Additional scrolling decorations\r\nlet spaceStation1Image: HTMLImageElement | null = null;\r\nlet spaceStation2Image: HTMLImageElement | null = null;\r\nlet rockImage: HTMLImageElement | null = null;\r\ninterface ScrollingDecor { x: number; y: number; scale: number; rotation: number; rotationSpeed: number; type: 'station1' | 'station2' | 'rock'; }\r\nlet scrollingDecors: ScrollingDecor[] = [];\r\n\r\n// Crosshair position\r\nlet crosshairX: number = 0;\r\nlet crosshairY: number = 0;\r\n\r\n// Smooth follow movement\r\nlet targetX: number = 0;\r\nlet targetY: number = 0;\r\nconst LERP_SPEED: number = 0.12;\r\nconst MAX_TILT: number = 25;\r\nlet lastPlayerX: number = 0;\r\n\r\n// 3D Perspective settings\r\nconst HORIZON_Y = 0.2;\r\nconst PERSPECTIVE_SCALE = 2.5;\r\n\r\n// Power-up system\r\nconst DODGE_PHASE_DURATION = 5000;\r\nlet powerUpsSpawned: boolean = false;\r\nlet powerUpIdCounter: number = 0;\r\n\r\n// Counters\r\nlet asteroidIdCounter: number = 0;\r\nlet bulletIdCounter: number = 0;\r\nlet enemyIdCounter: number = 0;\r\nlet asteroidsSpawned: number = 0;\r\nlet enemiesSpawned: number = 0;\r\nlet bossSpawned: boolean = false;\r\nlet bossEscaped: boolean = false;\r\nlet lastFireTime: number = 0;\r\nlet lastSpawnTime: number = 0;\r\nlet lastEnemySpawnTime: number = 0;\r\nlet gameStartTime: number = 0;\r\n\r\n// Weapon settings\r\nconst WEAPON_DURATION = 5000;\r\n\r\n// Lives system\r\nconst PLAYER_MAX_LIVES = 3;\r\nconst LIFE_MAX_HP = 10;\r\nconst IMMUNITY_DURATION = 3000; // 3 seconds immunity after losing a life\r\nlet playerLives: number = 3;\r\nlet playerLifeHP: number = 10;\r\nlet isImmune: boolean = false;\r\nlet immuneEndTime: number = 0;\r\n\r\n// More moving asteroids based on difficulty\r\nconst MOVING_ASTEROID_COUNT = {\r\n    easy: 8,\r\n    medium: 15,\r\n    hard: 25\r\n};\r\nconst ENEMY_ROCKET_COUNT = {\r\n    easy: 12,\r\n    medium: 18,\r\n    hard: 25\r\n};\r\n\r\n// Stats\r\nlet gameStats: GameStats = {\r\n    hits: 0,\r\n    asteroidsDestroyed: 0,\r\n    bossDestroyed: false,\r\n    score: 0,\r\n    success: false,\r\n    playerHP: 0,\r\n    isEliminated: false\r\n};\r\n\r\n// Controls\r\nlet isFiring: boolean = false;\r\nlet keys: { [key: string]: boolean } = {};\r\n\r\n// Event handlers\r\nlet mouseMoveHandler: ((e: MouseEvent) => void) | null = null;\r\nlet touchMoveHandler: ((e: TouchEvent) => void) | null = null;\r\nlet keyDownHandler: ((e: KeyboardEvent) => void) | null = null;\r\nlet keyUpHandler: ((e: KeyboardEvent) => void) | null = null;\r\nlet mouseDownHandler: ((e: MouseEvent) => void) | null = null;\r\nlet mouseUpHandler: ((e: MouseEvent) => void) | null = null;\r\n\r\n// ============ AUDIO SYSTEM ============\r\n\r\nclass AudioManager {\r\n    private audioContext: AudioContext | null = null;\r\n    private isMuted: boolean = false;\r\n\r\n    constructor() {\r\n        try {\r\n            this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\r\n        } catch (e) {\r\n            console.log('Audio context not available');\r\n        }\r\n    }\r\n\r\n    playSoundEffect(type: 'spread' | 'laser' | 'magnetic' | 'hit' | 'powerup' | 'explosion'): void {\r\n        if (!this.audioContext || this.isMuted) return;\r\n\r\n        const now = this.audioContext.currentTime;\r\n        const osc = this.audioContext.createOscillator();\r\n        const gain = this.audioContext.createGain();\r\n\r\n        osc.connect(gain);\r\n        gain.connect(this.audioContext.destination);\r\n\r\n        switch (type) {\r\n            case 'spread':\r\n                osc.frequency.value = 400;\r\n                gain.gain.setValueAtTime(0.12, now);\r\n                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\r\n                osc.start(now);\r\n                osc.stop(now + 0.1);\r\n                break;\r\n\r\n            case 'laser':\r\n                osc.frequency.setValueAtTime(800, now);\r\n                osc.frequency.exponentialRampToValueAtTime(200, now + 0.15);\r\n                gain.gain.setValueAtTime(0.12, now);\r\n                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\r\n                osc.start(now);\r\n                osc.stop(now + 0.15);\r\n                break;\r\n\r\n            case 'magnetic':\r\n                osc.frequency.setValueAtTime(600, now);\r\n                gain.gain.setValueAtTime(0.12, now);\r\n                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.08);\r\n                osc.start(now);\r\n                osc.stop(now + 0.08);\r\n                break;\r\n\r\n            case 'hit':\r\n                osc.frequency.value = 150;\r\n                gain.gain.setValueAtTime(0.15, now);\r\n                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\r\n                osc.start(now);\r\n                osc.stop(now + 0.2);\r\n                break;\r\n\r\n            case 'explosion':\r\n                osc.frequency.value = 80;\r\n                gain.gain.setValueAtTime(0.2, now);\r\n                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);\r\n                osc.start(now);\r\n                osc.stop(now + 0.3);\r\n                break;\r\n\r\n            case 'powerup':\r\n                osc.frequency.setValueAtTime(400, now);\r\n                osc.frequency.exponentialRampToValueAtTime(800, now + 0.2);\r\n                gain.gain.setValueAtTime(0.12, now);\r\n                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);\r\n                osc.start(now);\r\n                osc.stop(now + 0.3);\r\n                break;\r\n        }\r\n    }\r\n}\r\n\r\nlet audioManager = new AudioManager();\r\n\r\n// ============ 3D PERSPECTIVE HELPERS ============\r\n\r\nfunction getScreenPosition(laneX: number, z: number): { x: number; y: number; scale: number } {\r\n    if (!canvas) return { x: 0, y: 0, scale: 1 };\r\n\r\n    const horizonY = canvas.height * HORIZON_Y;\r\n    const playerY = canvas.height - 100;\r\n    const centerX = canvas.width / 2;\r\n\r\n    const screenY = horizonY + (playerY - horizonY) * z;\r\n    const spreadFactor = z * 0.85 + 0.15;\r\n    const screenX = centerX + (laneX * canvas.width * 0.45 * spreadFactor);\r\n    const scale = 0.2 + z * 0.8;\r\n\r\n    return { x: screenX, y: screenY, scale };\r\n}\r\n\r\n// ============ MAIN FUNCTIONS ============\r\n\r\nexport function startMiniGame(\r\n    spaceship: Spaceship,\r\n    difficulty: DifficultyLevel,\r\n    callback: MiniGameCallback\r\n): void {\r\n    onComplete = callback;\r\n    callbackCalled = false;\r\n    currentDifficulty = difficulty;\r\n\r\n    canvas = document.getElementById('minigame-canvas') as HTMLCanvasElement;\r\n    if (!canvas) {\r\n        console.error('Canvas not found');\r\n        callback({ hits: 0, asteroidsDestroyed: 0, bossDestroyed: false, score: 0, success: false, playerHP: 0, isEliminated: false });\r\n        return;\r\n    }\r\n\r\n    ctx = canvas.getContext('2d');\r\n    if (!ctx) {\r\n        console.error('Could not get canvas context');\r\n        callback({ hits: 0, asteroidsDestroyed: 0, bossDestroyed: false, score: 0, success: false, playerHP: 0, isEliminated: false });\r\n        return;\r\n    }\r\n\r\n    // Set canvas to full screen\r\n    canvas.width = window.innerWidth;\r\n    canvas.height = window.innerHeight;\r\n\r\n    // Get difficulty config\r\n    difficultyConfig = difficultyConfigs[difficulty];\r\n\r\n    // Initialize spread as base weapon from the start\r\n    currentWeapon = 'spread';\r\n    hasWeapon = true;\r\n    weaponConfig = {\r\n        type: 'spread',\r\n        fireRate: 180,\r\n        bulletSpeed: 14,\r\n        bulletWidth: 6,\r\n        bulletHeight: 15,\r\n        damage: 80,\r\n        color: '#ff6b6b',\r\n        spreadCount: 3,\r\n        isAutoFire: true\r\n    };\r\n\r\n    // Reset secondary weapon (from power-up)\r\n    secondaryWeapon = null;\r\n    secondaryWeaponConfig = null;\r\n    secondaryWeaponEndTime = 0;\r\n\r\n    // Reset power-up system\r\n    powerUpsSpawned = false;\r\n    powerUps = [];\r\n    powerUpIdCounter = 0;\r\n\r\n    // Reset game state\r\n    bullets = [];\r\n    movingAsteroids = [];\r\n    enemyRockets = [];\r\n    enemyBullets = [];\r\n    asteroidsSpawned = 0;\r\n    enemiesSpawned = 0;\r\n    bossSpawned = false;\r\n    bossEscaped = false;\r\n    bossRocket = null; // Reset boss rocket\r\n    asteroidIdCounter = 0;\r\n    bulletIdCounter = 0;\r\n    enemyIdCounter = 0;\r\n    lastFireTime = 0;\r\n    lastSpawnTime = 0;\r\n    lastEnemySpawnTime = 0;\r\n    gameStartTime = Date.now();\r\n    isGameRunning = true;\r\n    isFiring = true; // Auto-fire enabled with base weapon\r\n\r\n    // Initialize lives system\r\n    playerLives = PLAYER_MAX_LIVES;\r\n    playerLifeHP = LIFE_MAX_HP;\r\n    isImmune = false;\r\n    immuneEndTime = 0;\r\n    keys = {};\r\n\r\n    // Reset stats\r\n    gameStats = {\r\n        hits: 0,\r\n        asteroidsDestroyed: 0,\r\n        bossDestroyed: false,\r\n        score: 0,\r\n        success: false,\r\n        playerHP: 0,\r\n        isEliminated: false\r\n    };\r\n\r\n    // Load meteor image\r\n    meteorImage = new Image();\r\n    meteorImage.src = '/assets/meteor.png';\r\n\r\n    // Load background image\r\n    backgroundImage = new Image();\r\n    backgroundImage.src = '/assets/bgbaru10.png';\r\n    backgroundY1 = 0;\r\n    backgroundY2 = -canvas.height;\r\n\r\n    // Set difficulty-based scroll speed\r\n    const scrollSpeeds = { easy: 3, medium: 5, hard: 7 };\r\n    backgroundScrollSpeed = scrollSpeeds[difficulty];\r\n\r\n    // Load smoke texture\r\n    smokeImage = new Image();\r\n    smokeImage.src = '/assets/Smoke Texture.png';\r\n    smokeParticles = [];\r\n    lastSmokeSpawnTime = 0;\r\n\r\n    // Load enemy rocket image\r\n    enemyRocketImage = new Image();\r\n    enemyRocketImage.src = '/assets/roket_musuh.png';\r\n\r\n    // Load explosion image\r\n    explosionImage = new Image();\r\n    explosionImage.src = '/assets/bullet_16.png';\r\n    explosionParticles = [];\r\n\r\n    // Load bullet images\r\n    bulletSpreadImage = new Image();\r\n    bulletSpreadImage.src = '/assets/bullet_25.png';\r\n    bulletMagneticImage = new Image();\r\n    bulletMagneticImage.src = '/assets/bullet_73_5.png';\r\n    bulletLaserImage = new Image();\r\n    bulletLaserImage.src = '/assets/bullet_68.png';\r\n\r\n    // Load boss rocket image\r\n    bossRocketImage = new Image();\r\n    bossRocketImage.src = '/assets/roket_bos.png';\r\n    bossBulletImage = new Image();\r\n    bossBulletImage.src = '/assets/bullet_4_2_0.png';\r\n\r\n\r\n\r\n    // Load additional scrolling decoration images\r\n    spaceStation1Image = new Image();\r\n    spaceStation1Image.src = '/assets/spaceStation_8.1.png';\r\n    spaceStation2Image = new Image();\r\n    spaceStation2Image.src = '/assets/spacestation_1_0.png';\r\n    rockImage = new Image();\r\n    rockImage.src = '/assets/batu.png';\r\n    initScrollingDecors(canvas);\r\n\r\n    // Load spaceship image\r\n    const spaceshipImg = new Image();\r\n    spaceshipImg.src = spaceship.image;\r\n\r\n    // Initialize player at bottom center (no HP with base weapon)\r\n    player = {\r\n        x: canvas.width / 2,\r\n        y: canvas.height - 100,\r\n        width: 70,\r\n        height: 70,\r\n        speed: 10,\r\n        image: spaceshipImg,\r\n        dx: 0,\r\n        dy: 0,\r\n        hp: 0, // No HP with base weapon (invincible)\r\n        maxHp: 0,\r\n        tilt: 0\r\n    };\r\n\r\n    // Initialize crosshair and target\r\n    crosshairX = canvas.width / 2;\r\n    crosshairY = canvas.height / 2;\r\n    targetX = player.x;\r\n    targetY = player.y;\r\n    lastPlayerX = player.x;\r\n\r\n    // Update UI\r\n    updateUI();\r\n\r\n    // Setup controls\r\n    setupControls();\r\n\r\n    // Start game loop\r\n    gameLoop = requestAnimationFrame(update);\r\n}\r\n\r\n\r\n\r\nfunction setupControls(): void {\r\n    if (!canvas) return;\r\n\r\n    const updateTargetPosition = (clientX: number, clientY: number): void => {\r\n        if (!isGameRunning || !player || !canvas) return;\r\n        const rect = canvas.getBoundingClientRect();\r\n        crosshairX = clientX - rect.left;\r\n        crosshairY = clientY - rect.top;\r\n\r\n        // Player can move freely to all corners of the canvas\r\n        targetX = Math.max(player.width / 2, Math.min(canvas.width - player.width / 2, crosshairX));\r\n        targetY = Math.max(player.height / 2, Math.min(canvas.height - player.height / 2, crosshairY));\r\n    };\r\n\r\n    mouseMoveHandler = (e: MouseEvent): void => {\r\n        updateTargetPosition(e.clientX, e.clientY);\r\n    };\r\n    document.addEventListener('mousemove', mouseMoveHandler);\r\n\r\n    touchMoveHandler = (e: TouchEvent): void => {\r\n        e.preventDefault();\r\n        if (e.touches.length > 0) {\r\n            updateTargetPosition(e.touches[0].clientX, e.touches[0].clientY);\r\n        }\r\n    };\r\n    canvas.addEventListener('touchmove', touchMoveHandler, { passive: false });\r\n\r\n    keyDownHandler = (e: KeyboardEvent): void => {\r\n        if (!isGameRunning || !player) return;\r\n        keys[e.key.toLowerCase()] = true;\r\n        if (e.key === ' ' || e.code === 'Space') isFiring = true;\r\n    };\r\n    keyUpHandler = (e: KeyboardEvent): void => {\r\n        if (!player) return;\r\n        keys[e.key.toLowerCase()] = false;\r\n        if (e.key === ' ' || e.code === 'Space') isFiring = false;\r\n    };\r\n    document.addEventListener('keydown', keyDownHandler);\r\n    document.addEventListener('keyup', keyUpHandler);\r\n\r\n    mouseDownHandler = (): void => { isFiring = true; };\r\n    mouseUpHandler = (): void => { isFiring = false; };\r\n    document.addEventListener('mousedown', mouseDownHandler);\r\n    document.addEventListener('mouseup', mouseUpHandler);\r\n}\r\n\r\n// ============ GAME LOOP ============\r\n\r\nfunction update(): void {\r\n    if (!isGameRunning || !ctx || !canvas || !player || !difficultyConfig) {\r\n        return;\r\n    }\r\n\r\n    const now = Date.now();\r\n    const elapsed = now - gameStartTime;\r\n    const isInDodgePhase = elapsed < DODGE_PHASE_DURATION;\r\n\r\n    // Draw background\r\n    drawBackground();\r\n\r\n    // Handle keyboard movement\r\n    if (keys['arrowleft'] || keys['a']) {\r\n        targetX = Math.max(player.width / 2, targetX - player.speed);\r\n    }\r\n    if (keys['arrowright'] || keys['d']) {\r\n        targetX = Math.min(canvas.width - player.width / 2, targetX + player.speed);\r\n    }\r\n    if (keys['arrowup'] || keys['w']) {\r\n        targetY = Math.max(player.height / 2, targetY - player.speed);\r\n    }\r\n    if (keys['arrowdown'] || keys['s']) {\r\n        targetY = Math.min(canvas.height - player.height / 2, targetY + player.speed);\r\n    }\r\n\r\n    // Smooth follow movement\r\n    player.x += (targetX - player.x) * LERP_SPEED;\r\n    player.y += (targetY - player.y) * LERP_SPEED;\r\n\r\n    // Calculate swing/tilt animation\r\n    const moveDirection = player.x - lastPlayerX;\r\n    const targetTilt = Math.max(-MAX_TILT, Math.min(MAX_TILT, moveDirection * 3));\r\n    player.tilt += (targetTilt - player.tilt) * 0.15;\r\n    lastPlayerX = player.x;\r\n\r\n    // Spawn power-ups after dodge phase (only if player hasn't caught secondary weapon yet)\r\n    if (!isInDodgePhase && !powerUpsSpawned && !secondaryWeapon) {\r\n        spawnScatteredPowerUps();\r\n        powerUpsSpawned = true;\r\n    }\r\n    updatePowerUps();\r\n\r\n    // Firing - bullets go STRAIGHT UP\r\n    if (hasWeapon && weaponConfig && isFiring && now - lastFireTime >= weaponConfig.fireRate) {\r\n        fireBullets();\r\n        lastFireTime = now;\r\n    }\r\n\r\n    // Spawn moving asteroids\r\n    if (asteroidsSpawned < difficultyConfig.totalAsteroids &&\r\n        now - lastSpawnTime >= difficultyConfig.asteroidSpawnRate) {\r\n        spawnMovingAsteroid(false);\r\n        lastSpawnTime = now;\r\n    }\r\n\r\n    // Spawn enemy rockets (faster spawn rate)\r\n    const maxEnemies = ENEMY_ROCKET_COUNT[currentDifficulty];\r\n    if (enemiesSpawned < maxEnemies && now - lastEnemySpawnTime >= 600) {\r\n        spawnEnemyRocket();\r\n        lastEnemySpawnTime = now;\r\n    }\r\n\r\n\r\n\r\n    // Spawn boss rocket after 9 seconds for ALL difficulties\r\n    const BOSS_SPAWN_TIME = 9000; // Boss appears after 9seconds\r\n    if (elapsed >= BOSS_SPAWN_TIME && !bossSpawned && !bossRocket) {\r\n        spawnBossRocket();\r\n        bossSpawned = true;\r\n    }\r\n\r\n    // Update boss rocket if present\r\n    if (bossRocket) {\r\n        updateBossRocket(now);\r\n    }\r\n\r\n    // Update game objects (sorted by y for depth)\r\n    movingAsteroids.sort((a, b) => a.y - b.y);\r\n\r\n    updateMovingAsteroids();\r\n    updateEnemyRockets(now);\r\n    updateEnemyBullets();\r\n    updateBullets();\r\n\r\n    // Update and draw smoke particles\r\n    updateSmokeParticles();\r\n\r\n    // Update and draw explosion particles\r\n    updateExplosionParticles();\r\n\r\n    // Draw player\r\n    drawPlayer();\r\n\r\n    // Draw crosshair\r\n    drawCrosshair();\r\n\r\n    // Draw UI overlay\r\n    drawUI(isInDodgePhase, elapsed);\r\n\r\n    // Check conditions\r\n    if (checkWinCondition()) {\r\n        gameStats.success = true;\r\n        endGame();\r\n        return;\r\n    }\r\n\r\n    // Check if player is out of lives\r\n    if (playerLives <= 0) {\r\n        gameStats.success = false;\r\n        gameStats.isEliminated = true;\r\n        endGame();\r\n        return;\r\n    }\r\n\r\n    // Check immunity expiry\r\n    if (isImmune && Date.now() > immuneEndTime) {\r\n        isImmune = false;\r\n    }\r\n\r\n    // Weapon timer check (secondary weapon expires after duration)\r\n    if (secondaryWeapon && Date.now() > secondaryWeaponEndTime) {\r\n        secondaryWeapon = null;\r\n        secondaryWeaponConfig = null;\r\n        updateUI();\r\n        audioManager.playSoundEffect('powerup');\r\n    }\r\n\r\n    // Collision damage checks (only if not immune)\r\n    if (!isImmune) {\r\n        // Check collision with moving asteroids (3 HP damage)\r\n        if (checkMovingAsteroidCollision()) {\r\n            applyDamage(3);\r\n        }\r\n\r\n        // Check collision with enemy rockets (2 HP damage)\r\n        if (checkEnemyRocketCollision()) {\r\n            applyDamage(2);\r\n        }\r\n    }\r\n\r\n    gameLoop = requestAnimationFrame(update);\r\n}\r\n\r\n// ============ DAMAGE SYSTEM ============\r\n\r\nfunction applyDamage(amount: number): void {\r\n    // Skip if immune\r\n    if (isImmune) return;\r\n\r\n    // Reduce HP\r\n    playerLifeHP -= amount;\r\n    audioManager.playSoundEffect('hit');\r\n\r\n    // Check if life is lost\r\n    if (playerLifeHP <= 0) {\r\n        playerLives--;\r\n\r\n        if (playerLives > 0) {\r\n            // Respawn with full HP and immunity\r\n            playerLifeHP = LIFE_MAX_HP;\r\n            isImmune = true;\r\n            immuneEndTime = Date.now() + IMMUNITY_DURATION;\r\n            audioManager.playSoundEffect('explosion');\r\n        } else {\r\n            // No lives left - game over handled in update loop\r\n            playerLifeHP = 0;\r\n        }\r\n    }\r\n\r\n    updateUI();\r\n}\r\n\r\n// ============ BACKGROUND ============\r\n\r\nfunction initBoosterDecors(canvasRef: HTMLCanvasElement): void {\r\n    boosterDecors = [];\r\n    const count = 8 + Math.floor(Math.random() * 5); // 8-12 boosters\r\n    for (let i = 0; i < count; i++) {\r\n        boosterDecors.push({\r\n            x: Math.random() * canvasRef.width,\r\n            y: Math.random() * canvasRef.height * 2 - canvasRef.height, // Spread across 2x height\r\n            scale: 0.4 + Math.random() * 0.6,\r\n            rotation: Math.random() * Math.PI * 2,\r\n            rotationSpeed: (Math.random() - 0.5) * 0.02\r\n        });\r\n    }\r\n}\r\n\r\nfunction updateBoosterDecors(): void {\r\n    if (!canvas) return;\r\n\r\n    for (const booster of boosterDecors) {\r\n        booster.y += backgroundScrollSpeed * 0.8;\r\n        booster.rotation += booster.rotationSpeed;\r\n\r\n        // Reset to top when scrolled past bottom\r\n        if (booster.y > canvas.height + 50) {\r\n            booster.y = -100 - Math.random() * 200;\r\n            booster.x = Math.random() * canvas.width;\r\n            booster.scale = 0.4 + Math.random() * 0.6;\r\n        }\r\n    }\r\n}\r\n\r\nfunction drawBoosterDecors(): void {\r\n    if (!ctx || !canvas || !boosterImage || !boosterImage.complete) return;\r\n\r\n    ctx.save();\r\n    for (const booster of boosterDecors) {\r\n        const size = 60 * booster.scale;\r\n        ctx.save();\r\n        ctx.translate(booster.x, booster.y);\r\n        ctx.rotate(booster.rotation);\r\n        ctx.globalAlpha = 0.7;\r\n        ctx.drawImage(boosterImage, -size / 2, -size / 2, size, size);\r\n        ctx.restore();\r\n    }\r\n    ctx.restore();\r\n}\r\n\r\nfunction initScrollingDecors(canvasRef: HTMLCanvasElement): void {\r\n    scrollingDecors = [];\r\n    const count = 6 + Math.floor(Math.random() * 4); // 6-9 decorations\r\n    const types: ('station1' | 'station2' | 'rock')[] = ['station1', 'station2', 'rock'];\r\n\r\n    for (let i = 0; i < count; i++) {\r\n        scrollingDecors.push({\r\n            x: Math.random() * canvasRef.width,\r\n            y: Math.random() * canvasRef.height * 2 - canvasRef.height,\r\n            scale: 0.3 + Math.random() * 0.5,\r\n            rotation: Math.random() * Math.PI * 2,\r\n            rotationSpeed: (Math.random() - 0.5) * 0.01,\r\n            type: types[Math.floor(Math.random() * types.length)]\r\n        });\r\n    }\r\n}\r\n\r\nfunction updateScrollingDecors(): void {\r\n    if (!canvas) return;\r\n\r\n    for (const decor of scrollingDecors) {\r\n        decor.y += backgroundScrollSpeed * 0.6;\r\n        decor.rotation += decor.rotationSpeed;\r\n\r\n        // Reset to top when scrolled past bottom\r\n        if (decor.y > canvas.height + 100) {\r\n            decor.y = -150 - Math.random() * 300;\r\n            decor.x = Math.random() * canvas.width;\r\n            decor.scale = 0.3 + Math.random() * 0.5;\r\n        }\r\n    }\r\n}\r\n\r\nfunction drawScrollingDecors(): void {\r\n    if (!ctx || !canvas) return;\r\n\r\n    ctx.save();\r\n    for (const decor of scrollingDecors) {\r\n        let img: HTMLImageElement | null = null;\r\n        let baseSize = 80;\r\n\r\n        if (decor.type === 'station1' && spaceStation1Image?.complete) {\r\n            img = spaceStation1Image;\r\n            baseSize = 100;\r\n        } else if (decor.type === 'station2' && spaceStation2Image?.complete) {\r\n            img = spaceStation2Image;\r\n            baseSize = 70;\r\n        } else if (decor.type === 'rock' && rockImage?.complete) {\r\n            img = rockImage;\r\n            baseSize = 50;\r\n        }\r\n\r\n        if (img) {\r\n            const size = baseSize * decor.scale;\r\n            ctx.save();\r\n            ctx.translate(decor.x, decor.y);\r\n            ctx.rotate(decor.rotation);\r\n            ctx.globalAlpha = 0.8;\r\n            ctx.drawImage(img, -size / 2, -size / 2, size, size);\r\n            ctx.restore();\r\n        }\r\n    }\r\n    ctx.restore();\r\n}\r\n\r\nfunction spawnSmokeParticle(): void {\r\n    if (!player) return;\r\n\r\n    const offsetX = (Math.random() - 0.5) * 20;\r\n    const offsetY = player.height / 2 + 10;\r\n\r\n    smokeParticles.push({\r\n        x: player.x + offsetX,\r\n        y: player.y + offsetY,\r\n        alpha: 0.6 + Math.random() * 0.3,\r\n        scale: 0.3 + Math.random() * 0.3,\r\n        age: 0,\r\n        vx: (Math.random() - 0.5) * 0.8,\r\n        vy: 1.5 + Math.random() * 1\r\n    });\r\n}\r\n\r\nfunction updateSmokeParticles(): void {\r\n    if (!ctx || !canvas || !smokeImage || !smokeImage.complete) return;\r\n\r\n    const now = Date.now();\r\n\r\n    // Spawn new particles (reduced rate for performance)\r\n    if (player && now - lastSmokeSpawnTime > 100) {\r\n        spawnSmokeParticle();\r\n        lastSmokeSpawnTime = now;\r\n    }\r\n\r\n    // Update and draw particles\r\n    ctx.save();\r\n    for (let i = smokeParticles.length - 1; i >= 0; i--) {\r\n        const particle = smokeParticles[i];\r\n\r\n        particle.x += particle.vx;\r\n        particle.y += particle.vy;\r\n        particle.age++;\r\n        particle.alpha -= 0.015;\r\n        particle.scale += 0.008;\r\n\r\n        if (particle.alpha <= 0) {\r\n            smokeParticles.splice(i, 1);\r\n            continue;\r\n        }\r\n\r\n        const size = 50 * particle.scale;\r\n        ctx.save();\r\n        ctx.translate(particle.x, particle.y);\r\n        ctx.globalAlpha = particle.alpha;\r\n        ctx.drawImage(smokeImage, -size / 2, -size / 2, size, size);\r\n        ctx.restore();\r\n    }\r\n    ctx.restore();\r\n\r\n    // Limit particle count\r\n    if (smokeParticles.length > 100) {\r\n        smokeParticles.splice(0, smokeParticles.length - 100);\r\n    }\r\n}\r\n\r\nfunction drawBackground(): void {\r\n    if (!ctx || !canvas) return;\r\n\r\n    // Scroll background\r\n    backgroundY1 += backgroundScrollSpeed;\r\n    backgroundY2 += backgroundScrollSpeed;\r\n\r\n    // Reset positions for seamless loop\r\n    if (backgroundY1 >= canvas.height) {\r\n        backgroundY1 = backgroundY2 - canvas.height;\r\n    }\r\n    if (backgroundY2 >= canvas.height) {\r\n        backgroundY2 = backgroundY1 - canvas.height;\r\n    }\r\n\r\n    // Draw scrolling background image with pixel-perfect positioning\r\n    if (backgroundImage && backgroundImage.complete) {\r\n        // Use Math.floor to prevent sub-pixel gaps\r\n        ctx.drawImage(backgroundImage, 0, Math.floor(backgroundY1), canvas.width, canvas.height);\r\n        ctx.drawImage(backgroundImage, 0, Math.floor(backgroundY2), canvas.width, canvas.height);\r\n    } else {\r\n        // Fallback gradient\r\n        const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);\r\n        gradient.addColorStop(0, '#0a0015');\r\n        gradient.addColorStop(0.3, '#1a0030');\r\n        gradient.addColorStop(0.7, '#2d0050');\r\n        gradient.addColorStop(1, '#150025');\r\n        ctx.fillStyle = gradient;\r\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n    }\r\n\r\n    // Update and draw booster decorations\r\n    updateBoosterDecors();\r\n    drawBoosterDecors();\r\n\r\n    // Update and draw additional scrolling decorations\r\n    updateScrollingDecors();\r\n    drawScrollingDecors();\r\n}\r\n\r\n// ============ EXPLOSION PARTICLES ============\r\n\r\nfunction spawnExplosion(x: number, y: number, size: number = 1): void {\r\n    // Spawn multiple explosion particles for a more dramatic effect\r\n    const particleCount = 3 + Math.floor(Math.random() * 3);\r\n    for (let i = 0; i < particleCount; i++) {\r\n        explosionParticles.push({\r\n            x: x + (Math.random() - 0.5) * 30 * size,\r\n            y: y + (Math.random() - 0.5) * 30 * size,\r\n            scale: (0.5 + Math.random() * 0.8) * size,\r\n            alpha: 1,\r\n            rotation: Math.random() * Math.PI * 2,\r\n            age: 0\r\n        });\r\n    }\r\n}\r\n\r\nfunction updateExplosionParticles(): void {\r\n    if (!ctx || !explosionImage || !explosionImage.complete) return;\r\n\r\n    ctx.save();\r\n    for (let i = explosionParticles.length - 1; i >= 0; i--) {\r\n        const particle = explosionParticles[i];\r\n\r\n        particle.age++;\r\n        particle.alpha -= 0.03;\r\n        particle.scale += 0.02;\r\n        particle.rotation += 0.05;\r\n\r\n        if (particle.alpha <= 0) {\r\n            explosionParticles.splice(i, 1);\r\n            continue;\r\n        }\r\n\r\n        const drawSize = 80 * particle.scale;\r\n        ctx.save();\r\n        ctx.translate(particle.x, particle.y);\r\n        ctx.rotate(particle.rotation);\r\n        ctx.globalAlpha = particle.alpha;\r\n        ctx.drawImage(explosionImage, -drawSize / 2, -drawSize / 2, drawSize, drawSize);\r\n        ctx.restore();\r\n    }\r\n    ctx.restore();\r\n\r\n    // Limit particle count\r\n    if (explosionParticles.length > 50) {\r\n        explosionParticles.splice(0, explosionParticles.length - 50);\r\n    }\r\n}\r\n\r\n// ============ CROSSHAIR ============\r\n\r\nfunction drawCrosshair(): void {\r\n    if (!ctx || !canvas) return;\r\n\r\n    const x = crosshairX;\r\n    const y = crosshairY;\r\n\r\n    // Outer circle\r\n    ctx.strokeStyle = 'rgba(0, 255, 200, 0.8)';\r\n    ctx.lineWidth = 2;\r\n    ctx.beginPath();\r\n    ctx.arc(x, y, 18, 0, Math.PI * 2);\r\n    ctx.stroke();\r\n\r\n    // Inner dot\r\n    ctx.fillStyle = '#00ffc8';\r\n    ctx.beginPath();\r\n    ctx.arc(x, y, 4, 0, Math.PI * 2);\r\n    ctx.fill();\r\n\r\n    // Cross lines\r\n    ctx.strokeStyle = 'rgba(0, 255, 200, 0.6)';\r\n    ctx.lineWidth = 1;\r\n\r\n    ctx.beginPath();\r\n    ctx.moveTo(x - 28, y);\r\n    ctx.lineTo(x - 10, y);\r\n    ctx.stroke();\r\n\r\n    ctx.beginPath();\r\n    ctx.moveTo(x + 10, y);\r\n    ctx.lineTo(x + 28, y);\r\n    ctx.stroke();\r\n\r\n    ctx.beginPath();\r\n    ctx.moveTo(x, y - 28);\r\n    ctx.lineTo(x, y - 10);\r\n    ctx.stroke();\r\n\r\n    ctx.beginPath();\r\n    ctx.moveTo(x, y + 10);\r\n    ctx.lineTo(x, y + 28);\r\n    ctx.stroke();\r\n}\r\n\r\n// ============ UI OVERLAY ============\r\n\r\nfunction drawUI(isInDodgePhase: boolean, elapsed: number): void {\r\n    if (!ctx || !canvas || !player) return;\r\n\r\n    // ===== TOP CENTER: LIVES & HP BAR =====\r\n    const hpBarWidth = 200;\r\n    const hpBarHeight = 18;\r\n    const hpBarX = (canvas.width - hpBarWidth) / 2;\r\n    const hpBarY = 18;\r\n\r\n    // Background panel\r\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';\r\n    ctx.beginPath();\r\n    ctx.roundRect(hpBarX - 100, hpBarY - 4, hpBarWidth + 200, hpBarHeight + 12, 8);\r\n    ctx.fill();\r\n\r\n    // Draw lives (hearts)\r\n    ctx.font = '18px Arial';\r\n    ctx.textAlign = 'left';\r\n    for (let i = 0; i < PLAYER_MAX_LIVES; i++) {\r\n        if (i < playerLives) {\r\n            ctx.fillStyle = '#ff4466';\r\n            ctx.fillText('â¤ï¸', hpBarX - 90 + i * 25, hpBarY + 16);\r\n        } else {\r\n            ctx.fillStyle = 'rgba(255, 68, 102, 0.3)';\r\n            ctx.fillText('ðŸ–¤', hpBarX - 90 + i * 25, hpBarY + 16);\r\n        }\r\n    }\r\n\r\n    // HP bar empty\r\n    ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';\r\n    ctx.beginPath();\r\n    ctx.roundRect(hpBarX, hpBarY, hpBarWidth, hpBarHeight, 5);\r\n    ctx.fill();\r\n\r\n    // HP bar fill\r\n    const hpPercent = playerLifeHP / LIFE_MAX_HP;\r\n    const gradient = ctx.createLinearGradient(hpBarX, 0, hpBarX + hpBarWidth, 0);\r\n    gradient.addColorStop(0, '#ff4466');\r\n    gradient.addColorStop(1, '#ffaa00');\r\n    ctx.fillStyle = gradient;\r\n    ctx.beginPath();\r\n    ctx.roundRect(hpBarX, hpBarY, hpBarWidth * hpPercent, hpBarHeight, 5);\r\n    ctx.fill();\r\n\r\n    // HP text\r\n    ctx.font = 'bold 12px Orbitron, sans-serif';\r\n    ctx.fillStyle = '#ffffff';\r\n    ctx.textAlign = 'center';\r\n    ctx.fillText(`${playerLifeHP}/${LIFE_MAX_HP}`, canvas.width / 2, hpBarY + 14);\r\n\r\n    // Immunity indicator\r\n    if (isImmune) {\r\n        const immuneTimeLeft = Math.max(0, (immuneEndTime - Date.now()) / 1000);\r\n        ctx.font = 'bold 14px Orbitron, sans-serif';\r\n        ctx.fillStyle = '#00ffff';\r\n        ctx.textAlign = 'right';\r\n        ctx.fillText(`ðŸ›¡ï¸ ${immuneTimeLeft.toFixed(1)}s`, hpBarX + hpBarWidth + 90, hpBarY + 14);\r\n    }\r\n\r\n    // Weapon timer (if secondary weapon active)\r\n    if (secondaryWeapon) {\r\n        const timeLeft = Math.max(0, secondaryWeaponEndTime - Date.now());\r\n        ctx.font = 'bold 11px Orbitron, sans-serif';\r\n        ctx.fillStyle = '#00ddff';\r\n        ctx.textAlign = 'center';\r\n        ctx.fillText(`âš¡ ${(timeLeft / 1000).toFixed(1)}s`, canvas.width / 2, hpBarY + 38);\r\n    }\r\n\r\n    // ===== TOP RIGHT: STATS =====\r\n    ctx.textAlign = 'right';\r\n    ctx.font = '15px Orbitron, sans-serif';\r\n\r\n    ctx.fillStyle = '#ffcc00';\r\n    ctx.fillText(`ðŸ† ${gameStats.score}`, canvas.width - 20, 38);\r\n\r\n    // Boss status indicator\r\n    if (bossRocket) {\r\n        ctx.fillStyle = '#ff4444';\r\n        const bossHpPercent = Math.round((bossRocket.hp / bossRocket.maxHp) * 100);\r\n        ctx.fillText(`ðŸ‘¹ BOSS: ${bossHpPercent}%`, canvas.width - 20, 60);\r\n    } else if (!bossSpawned) {\r\n        const BOSS_SPAWN_TIME = 15000;\r\n        const timeUntilBoss = Math.max(0, Math.ceil((BOSS_SPAWN_TIME - elapsed) / 1000));\r\n        ctx.fillStyle = '#ffaa00';\r\n        ctx.fillText(`ðŸ‘¹ BOSS IN: ${timeUntilBoss}s`, canvas.width - 20, 60);\r\n    } else {\r\n        ctx.fillStyle = '#00ff88';\r\n        ctx.fillText(`ðŸ‘¹ BOSS DESTROYED!`, canvas.width - 20, 60);\r\n    }\r\n\r\n    ctx.fillStyle = '#ff6666';\r\n    ctx.fillText(`ðŸš€ ${enemyRockets.length}`, canvas.width - 20, 82);\r\n\r\n    // ===== PHASE INDICATOR =====\r\n    ctx.textAlign = 'center';\r\n    ctx.font = 'bold 16px Orbitron, sans-serif';\r\n\r\n    if (isInDodgePhase) {\r\n        const remaining = Math.ceil((DODGE_PHASE_DURATION - elapsed) / 1000);\r\n        ctx.fillStyle = '#ff6b6b';\r\n        ctx.fillText(`ðŸ”´ SPREAD + â±ï¸ ${remaining}s`, canvas.width / 2, 65);\r\n    } else if (!secondaryWeapon) {\r\n        ctx.fillStyle = '#00ff88';\r\n        ctx.fillText('ðŸ”´ SPREAD | ðŸŽ¯ CATCH POWER-UP!', canvas.width / 2, 65);\r\n    } else {\r\n        // Dual weapon display\r\n        const secondaryNames: Record<WeaponType, string> = {\r\n            'spread': 'ðŸ”´ SPREAD',\r\n            'laser': 'ðŸ”µ LASER',\r\n            'magnetic': 'ðŸŸ£ MAGNET'\r\n        };\r\n        ctx.fillStyle = '#00ffaa';\r\n        ctx.fillText(`ðŸ”´ SPREAD + ${secondaryNames[secondaryWeapon]} (DUAL!)`, canvas.width / 2, 65);\r\n    }\r\n\r\n    // ===== BOTTOM: CONTROLS =====\r\n    ctx.textAlign = 'center';\r\n    ctx.font = '13px Space Mono, monospace';\r\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';\r\n    ctx.fillText('MOVE: Mouse/WASD  |  ATTACK: Click/Space', canvas.width / 2, canvas.height - 18);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n// ============ BOSS ROCKET (HARD DIFFICULTY) ============\r\n\r\nfunction spawnBossRocket(): void {\r\n    if (!canvas) return;\r\n\r\n    bossRocket = {\r\n        x: canvas.width / 2,\r\n        y: -200, // Start above screen\r\n        width: 250,  // Large boss\r\n        height: 180,\r\n        speed: 1,    // Very slow movement\r\n        hp: 10000,\r\n        maxHp: 10000,\r\n        lastFireTime: 0,\r\n        // 4 turret positions (2 left, 2 right)\r\n        turrets: [\r\n            { offsetX: -100, offsetY: 50 },  // Far left\r\n            { offsetX: -60, offsetY: 70 },   // Near left\r\n            { offsetX: 60, offsetY: 70 },    // Near right\r\n            { offsetX: 100, offsetY: 50 }    // Far right\r\n        ]\r\n    };\r\n}\r\n\r\nfunction updateBossRocket(now: number): void {\r\n    if (!bossRocket || !ctx || !canvas || !player) return;\r\n\r\n    // Move boss slowly down, stop at 1/3 from top\r\n    const targetY = canvas.height * 0.25;\r\n    const bossInPosition = bossRocket.y >= targetY;\r\n\r\n    if (bossRocket.y < targetY) {\r\n        bossRocket.y += bossRocket.speed;\r\n    } else {\r\n        // After stopping, follow player's horizontal position (left/right only)\r\n        const playerCenterX = player.x + player.width / 2;\r\n        const bossFollowSpeed = 3; // Speed for horizontal following\r\n\r\n        if (Math.abs(bossRocket.x - playerCenterX) > 5) {\r\n            if (bossRocket.x < playerCenterX) {\r\n                bossRocket.x += bossFollowSpeed;\r\n            } else {\r\n                bossRocket.x -= bossFollowSpeed;\r\n            }\r\n        }\r\n    }\r\n\r\n    // BOSS BARRIER: When boss is in position, restrict player movement\r\n    if (bossInPosition) {\r\n        // Define barrier zone - player cannot go above this line\r\n        const barrierY = bossRocket.y + bossRocket.height / 2 + 80; // Barrier below boss\r\n\r\n        // Restrict player from going above barrier\r\n        if (player.y < barrierY) {\r\n            player.y = barrierY;\r\n        }\r\n\r\n        // Draw transparent barrier effect\r\n        drawBossBarrier(barrierY);\r\n    }\r\n\r\n    // Fire rapidly from 4 turrets every 150ms (fast burst)\r\n    if (now - bossRocket.lastFireTime >= 150) {\r\n        for (const turret of bossRocket.turrets) {\r\n            spawnBossBullet(\r\n                bossRocket.x + turret.offsetX,\r\n                bossRocket.y + turret.offsetY\r\n            );\r\n        }\r\n        bossRocket.lastFireTime = now;\r\n    }\r\n\r\n    drawBossRocket();\r\n}\r\n\r\n// Invisible barrier when boss is in position (no visual, collision only)\r\nfunction drawBossBarrier(barrierY: number): void {\r\n    // Barrier is completely transparent - no visual display\r\n}\r\n\r\nfunction spawnBossBullet(x: number, y: number): void {\r\n    if (!player) return;\r\n\r\n    // Shoot STRAIGHT DOWN (fast and rapid)\r\n    enemyBullets.push({\r\n        id: bulletIdCounter++,\r\n        x,\r\n        y,\r\n        z: 1,\r\n        width: 20,\r\n        height: 40,\r\n        speed: 12, // Fast bullet speed\r\n        damage: 25,\r\n        color: '#ffcc00', // Yellow for boss bullets\r\n        type: 'laser',\r\n        isEnemy: true,\r\n        angle: Math.PI / 2, // Straight down\r\n        dirX: 0,  // No horizontal movement\r\n        dirY: 1   // Straight down\r\n    } as any);\r\n}\r\n\r\nfunction drawBossRocket(): void {\r\n    if (!bossRocket || !ctx) return;\r\n\r\n    ctx.save();\r\n\r\n    // Red glow for boss\r\n    ctx.shadowBlur = 30;\r\n    ctx.shadowColor = '#ff0044';\r\n\r\n    if (bossRocketImage && bossRocketImage.complete) {\r\n        ctx.drawImage(\r\n            bossRocketImage,\r\n            bossRocket.x - bossRocket.width / 2,\r\n            bossRocket.y - bossRocket.height / 2,\r\n            bossRocket.width,\r\n            bossRocket.height\r\n        );\r\n    } else {\r\n        // Fallback shape\r\n        ctx.fillStyle = '#663399';\r\n        ctx.fillRect(\r\n            bossRocket.x - bossRocket.width / 2,\r\n            bossRocket.y - bossRocket.height / 2,\r\n            bossRocket.width,\r\n            bossRocket.height\r\n        );\r\n    }\r\n\r\n    // HP bar for boss\r\n    const barWidth = bossRocket.width * 0.8;\r\n    const barHeight = 10;\r\n    const barX = bossRocket.x - barWidth / 2;\r\n    const barY = bossRocket.y + bossRocket.height / 2 + 10;\r\n\r\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\r\n    ctx.fillRect(barX, barY, barWidth, barHeight);\r\n\r\n    const hpPercent = bossRocket.hp / bossRocket.maxHp;\r\n    ctx.fillStyle = '#ff0000';\r\n    ctx.fillRect(barX, barY, barWidth * hpPercent, barHeight);\r\n\r\n    // Boss label\r\n    ctx.fillStyle = '#ff4444';\r\n    ctx.font = 'bold 14px Orbitron, sans-serif';\r\n    ctx.textAlign = 'center';\r\n    ctx.fillText('BOSS', bossRocket.x, barY + 25);\r\n\r\n    ctx.restore();\r\n}\r\n\r\n// ============ MOVING ASTEROIDS (TO DESTROY) ============\r\n\r\nfunction spawnMovingAsteroid(isBoss: boolean): void {\r\n    if (!canvas || !difficultyConfig) return;\r\n\r\n    let size: number;\r\n    let hp: number;\r\n    let speed: number;\r\n\r\n    if (isBoss) {\r\n        size = difficultyConfig.bossSize;\r\n        hp = difficultyConfig.bossHP;\r\n        speed = 2; // Slower boss\r\n    } else {\r\n        const { min, max } = difficultyConfig.asteroidSize;\r\n        size = min + Math.random() * (max - min);\r\n        hp = difficultyConfig.asteroidHP;\r\n        speed = 3 + Math.random() * 2; // Pixel speed for straight fall\r\n        asteroidsSpawned++;\r\n    }\r\n\r\n    // Spawn at random X position at top of screen\r\n    const spawnX = 50 + Math.random() * (canvas.width - 100);\r\n\r\n    movingAsteroids.push({\r\n        id: asteroidIdCounter++,\r\n        x: spawnX,\r\n        y: -size, // Start above screen\r\n        z: 1, // Keep z for compatibility but not used for perspective\r\n        baseSize: size,\r\n        speed,\r\n        hp,\r\n        maxHp: hp,\r\n        isBoss,\r\n        rotation: Math.random() * Math.PI * 2,\r\n        rotationSpeed: (Math.random() - 0.5) * 0.04,\r\n        hitFlash: 0,\r\n        laneX: 0 // Not used anymore\r\n    });\r\n}\r\n\r\nfunction updateMovingAsteroids(): void {\r\n    if (!ctx || !canvas) return;\r\n\r\n    for (let i = movingAsteroids.length - 1; i >= 0; i--) {\r\n        const asteroid = movingAsteroids[i];\r\n\r\n        // Simple straight-down movement\r\n        asteroid.y += asteroid.speed;\r\n        asteroid.rotation += asteroid.rotationSpeed;\r\n        if (asteroid.hitFlash > 0) asteroid.hitFlash--;\r\n\r\n        drawMovingAsteroid(asteroid);\r\n\r\n        // Remove when off screen at bottom\r\n        if (asteroid.y > canvas.height + asteroid.baseSize) {\r\n            if (asteroid.isBoss) {\r\n                bossEscaped = true;\r\n                gameStats.success = false;\r\n            }\r\n            movingAsteroids.splice(i, 1);\r\n        }\r\n    }\r\n}\r\n\r\nfunction drawMovingAsteroid(asteroid: MovingAsteroid): void {\r\n    if (!ctx) return;\r\n\r\n    const size = asteroid.baseSize;\r\n\r\n    ctx.save();\r\n    ctx.translate(asteroid.x, asteroid.y);\r\n    ctx.rotate(asteroid.rotation);\r\n\r\n    if (meteorImage && meteorImage.complete) {\r\n        if (asteroid.hitFlash > 0) {\r\n            ctx.globalAlpha = 0.5 + Math.sin(asteroid.hitFlash * 0.5) * 0.5;\r\n            ctx.filter = 'brightness(2)';\r\n        }\r\n\r\n        if (asteroid.isBoss) {\r\n            ctx.shadowBlur = 30;\r\n            ctx.shadowColor = '#ff4444';\r\n        } else {\r\n            // White shadow for visibility on regular meteors\r\n            ctx.shadowBlur = 15;\r\n            ctx.shadowColor = 'rgba(255, 255, 255, 0.5)';\r\n        }\r\n\r\n        ctx.drawImage(meteorImage, -size / 2, -size / 2, size, size);\r\n        ctx.filter = 'none';\r\n        ctx.globalAlpha = 1;\r\n    } else {\r\n        ctx.fillStyle = asteroid.hitFlash > 0 ? '#ffffff' :\r\n            asteroid.isBoss ? '#ff4444' : '#aa6633';\r\n        ctx.beginPath();\r\n        ctx.arc(0, 0, size / 2, 0, Math.PI * 2);\r\n        ctx.fill();\r\n    }\r\n\r\n    // HP bar\r\n    if (asteroid.maxHp > 1) {\r\n        ctx.rotate(-asteroid.rotation);\r\n        const barWidth = size * 0.8;\r\n        const barHeight = 5;\r\n        const barY = -size / 2 - 12;\r\n\r\n        ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';\r\n        ctx.fillRect(-barWidth / 2, barY, barWidth, barHeight);\r\n\r\n        const hpPercent = asteroid.hp / asteroid.maxHp;\r\n        ctx.fillStyle = asteroid.isBoss ? '#ff0000' : '#06ffa5';\r\n        ctx.fillRect(-barWidth / 2, barY, barWidth * hpPercent, barHeight);\r\n    }\r\n\r\n    ctx.restore();\r\n}\r\n\r\nfunction checkMovingAsteroidCollision(): boolean {\r\n    if (!player || !canvas) return false;\r\n\r\n    for (let i = movingAsteroids.length - 1; i >= 0; i--) {\r\n        const asteroid = movingAsteroids[i];\r\n        // Check collision when asteroid is on screen\r\n        if (asteroid.y > -asteroid.baseSize && asteroid.y < canvas.height + asteroid.baseSize) {\r\n            const dist = Math.sqrt(\r\n                Math.pow(player.x - asteroid.x, 2) +\r\n                Math.pow(player.y - asteroid.y, 2)\r\n            );\r\n            const size = asteroid.baseSize;\r\n            if (dist < (player.width / 2 + size / 2) * 0.5) {\r\n                movingAsteroids.splice(i, 1);\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\n// ============ ENEMY ROCKETS ============\r\n\r\n// Direction types for enemy rockets\r\ntype SpawnDirection = 'top' | 'top-left' | 'top-right' | 'left' | 'right';\r\n\r\nfunction spawnEnemyRocket(): void {\r\n    if (!canvas) return;\r\n\r\n    // Random spawn direction\r\n    const directions: SpawnDirection[] = ['top', 'top-left', 'top-right', 'left', 'right'];\r\n    const direction = directions[Math.floor(Math.random() * directions.length)];\r\n\r\n    let startX: number;\r\n    let startY: number;\r\n    let speedX: number;\r\n    let speedY: number;\r\n\r\n    switch (direction) {\r\n        case 'top':\r\n            startX = canvas.width * 0.2 + Math.random() * canvas.width * 0.6;\r\n            startY = -50;\r\n            speedX = (Math.random() - 0.5) * 2;\r\n            speedY = 3 + Math.random() * 2;\r\n            break;\r\n        case 'top-left':\r\n            startX = -50;\r\n            startY = Math.random() * canvas.height * 0.3;\r\n            speedX = 3 + Math.random() * 2;\r\n            speedY = 2 + Math.random() * 1.5;\r\n            break;\r\n        case 'top-right':\r\n            startX = canvas.width + 50;\r\n            startY = Math.random() * canvas.height * 0.3;\r\n            speedX = -(3 + Math.random() * 2);\r\n            speedY = 2 + Math.random() * 1.5;\r\n            break;\r\n        case 'left':\r\n            startX = -50;\r\n            startY = canvas.height * 0.2 + Math.random() * canvas.height * 0.4;\r\n            speedX = 3 + Math.random() * 2;\r\n            speedY = (Math.random() - 0.5) * 2;\r\n            break;\r\n        case 'right':\r\n            startX = canvas.width + 50;\r\n            startY = canvas.height * 0.2 + Math.random() * canvas.height * 0.4;\r\n            speedX = -(3 + Math.random() * 2);\r\n            speedY = (Math.random() - 0.5) * 2;\r\n            break;\r\n    }\r\n\r\n    enemyRockets.push({\r\n        id: enemyIdCounter++,\r\n        x: startX,\r\n        y: startY,\r\n        z: 0.8, // Start visible\r\n        width: 40,\r\n        height: 50,\r\n        speed: 0.004,\r\n        hp: 50,\r\n        maxHp: 50,\r\n        laneX: 0, // Not used for screen-space movement\r\n        lastFireTime: 0,\r\n        // @ts-ignore - adding custom properties for directional movement\r\n        speedX: speedX,\r\n        speedY: speedY,\r\n        direction: direction\r\n    });\r\n\r\n    enemiesSpawned++;\r\n}\r\n\r\nfunction updateEnemyRockets(now: number): void {\r\n    if (!ctx || !canvas || !player) return;\r\n\r\n    for (let i = enemyRockets.length - 1; i >= 0; i--) {\r\n        const enemy = enemyRockets[i] as any;\r\n\r\n        // Enemy rockets CHASE the player\r\n        const dx = player.x - enemy.x;\r\n        const dy = player.y - enemy.y;\r\n        const dist = Math.sqrt(dx * dx + dy * dy);\r\n        const chaseSpeed = 2.5;\r\n\r\n        if (dist > 0) {\r\n            enemy.x += (dx / dist) * chaseSpeed;\r\n            enemy.y += (dy / dist) * chaseSpeed;\r\n        }\r\n\r\n        // Enemy shoots at player (straight bullets based on current direction)\r\n        if (now - enemy.lastFireTime > 1500) {\r\n            spawnEnemyBulletStraight(enemy, dx, dy, dist);\r\n            enemy.lastFireTime = now;\r\n        }\r\n\r\n        // Calculate rotation to face movement direction (chasing player)\r\n        const angle = Math.atan2(dy, dx) + Math.PI / 2;\r\n        drawEnemyRocketAtPosition(enemy, angle);\r\n\r\n        // Remove if reached player area or off screen for too long\r\n        if (enemy.x < -150 || enemy.x > canvas.width + 150 ||\r\n            enemy.y < -150 || enemy.y > canvas.height + 150) {\r\n            enemyRockets.splice(i, 1);\r\n        }\r\n    }\r\n}\r\n\r\nfunction drawEnemyRocketAtPosition(enemy: any, angle: number): void {\r\n    if (!ctx) return;\r\n\r\n    const w = enemy.width;\r\n    const h = enemy.height;\r\n\r\n    ctx.save();\r\n    ctx.translate(enemy.x, enemy.y);\r\n    ctx.rotate(angle);\r\n\r\n    // Draw enemy rocket image if loaded\r\n    if (enemyRocketImage && enemyRocketImage.complete) {\r\n        ctx.shadowBlur = 15;\r\n        ctx.shadowColor = '#ff0000';\r\n        ctx.drawImage(enemyRocketImage, -w / 2, -h / 2, w, h);\r\n    } else {\r\n        // Fallback to canvas drawing\r\n        ctx.shadowBlur = 15;\r\n        ctx.shadowColor = '#ff0000';\r\n        ctx.fillStyle = '#cc2222';\r\n        ctx.beginPath();\r\n        ctx.moveTo(0, -h / 2);\r\n        ctx.lineTo(w / 3, h / 3);\r\n        ctx.lineTo(-w / 3, h / 3);\r\n        ctx.closePath();\r\n        ctx.fill();\r\n\r\n        // Cockpit\r\n        ctx.fillStyle = '#222222';\r\n        ctx.beginPath();\r\n        ctx.arc(0, 0, w / 5, 0, Math.PI * 2);\r\n        ctx.fill();\r\n\r\n        // Engine glow\r\n        ctx.fillStyle = 'rgba(255, 100, 50, 0.8)';\r\n        ctx.beginPath();\r\n        ctx.moveTo(-w / 5, h / 3);\r\n        ctx.lineTo(0, h / 2 + Math.random() * 5);\r\n        ctx.lineTo(w / 5, h / 3);\r\n        ctx.closePath();\r\n        ctx.fill();\r\n    }\r\n\r\n    ctx.restore();\r\n\r\n    // HP bar\r\n    const barWidth = w * 0.8;\r\n    const barHeight = 4;\r\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';\r\n    ctx.fillRect(enemy.x - barWidth / 2, enemy.y - h / 2 - 10, barWidth, barHeight);\r\n    ctx.fillStyle = '#ff4444';\r\n    ctx.fillRect(enemy.x - barWidth / 2, enemy.y - h / 2 - 10, barWidth * (enemy.hp / enemy.maxHp), barHeight);\r\n}\r\n\r\n// Spawn straight bullet from enemy in specific direction\r\nfunction spawnEnemyBulletStraight(enemy: EnemyRocket, dx: number, dy: number, dist: number): void {\r\n    if (!player || dist === 0) return;\r\n\r\n    // Calculate direction at spawn time (bullet goes straight, doesn't track)\r\n    const dirX = dx / dist;\r\n    const dirY = dy / dist;\r\n\r\n    enemyBullets.push({\r\n        id: bulletIdCounter++,\r\n        x: enemy.x,\r\n        y: enemy.y,\r\n        z: enemy.z,\r\n        width: 6,\r\n        height: 12,\r\n        speed: 8,\r\n        damage: 25,\r\n        color: '#ff4444',\r\n        type: 'spread',\r\n        isEnemy: true,\r\n        // @ts-ignore - adding direction for straight movement\r\n        dirX: dirX,\r\n        dirY: dirY\r\n    });\r\n}\r\n\r\nfunction spawnEnemyBullet(enemy: EnemyRocket): void {\r\n    if (!player) return;\r\n\r\n    // Calculate direction at spawn time\r\n    const dx = player.x - enemy.x;\r\n    const dy = player.y - enemy.y;\r\n    const dist = Math.sqrt(dx * dx + dy * dy);\r\n\r\n    if (dist > 0) {\r\n        spawnEnemyBulletStraight(enemy, dx, dy, dist);\r\n    }\r\n}\r\n\r\nfunction updateEnemyBullets(): void {\r\n    if (!ctx || !canvas || !player) return;\r\n\r\n    for (let i = enemyBullets.length - 1; i >= 0; i--) {\r\n        const bullet = enemyBullets[i] as any;\r\n\r\n        // Move STRAIGHT in the direction set at spawn (not homing)\r\n        if (bullet.dirX !== undefined && bullet.dirY !== undefined) {\r\n            bullet.x += bullet.dirX * bullet.speed;\r\n            bullet.y += bullet.dirY * bullet.speed;\r\n        } else {\r\n            // Fallback: move straight down\r\n            bullet.y += bullet.speed;\r\n        }\r\n\r\n        // Check hit player\r\n        const hitDist = Math.sqrt(\r\n            Math.pow(player.x - bullet.x, 2) +\r\n            Math.pow(player.y - bullet.y, 2)\r\n        );\r\n\r\n        if (hitDist < player.width / 2) {\r\n            // Apply damage using lives system\r\n            applyDamage(1); // 1 HP damage per bullet\r\n            enemyBullets.splice(i, 1);\r\n            continue;\r\n        }\r\n\r\n        // Draw enemy bullet\r\n        ctx.save();\r\n        ctx.shadowBlur = 8;\r\n        ctx.shadowColor = bullet.color || '#ff0000';\r\n\r\n        // Use boss bullet image for boss bullets (yellow color)\r\n        if (bullet.color === '#ffcc00' && bossBulletImage && bossBulletImage.complete) {\r\n            const imgWidth = bullet.width || 20;\r\n            const imgHeight = bullet.height || 40;\r\n            // Rotate bullet towards movement direction\r\n            if (bullet.angle !== undefined) {\r\n                ctx.translate(bullet.x, bullet.y);\r\n                ctx.rotate(bullet.angle + Math.PI / 2);\r\n                ctx.drawImage(bossBulletImage, -imgWidth / 2, -imgHeight / 2, imgWidth, imgHeight);\r\n            } else {\r\n                ctx.drawImage(bossBulletImage, bullet.x - imgWidth / 2, bullet.y - imgHeight / 2, imgWidth, imgHeight);\r\n            }\r\n        } else {\r\n            // Normal enemy bullet (red circle)\r\n            ctx.fillStyle = '#ff4444';\r\n            ctx.beginPath();\r\n            ctx.arc(bullet.x, bullet.y, 5, 0, Math.PI * 2);\r\n            ctx.fill();\r\n        }\r\n        ctx.restore();\r\n\r\n        // Remove if off screen\r\n        if (bullet.y > canvas.height + 50 || bullet.y < -50 ||\r\n            bullet.x < -50 || bullet.x > canvas.width + 50) {\r\n            enemyBullets.splice(i, 1);\r\n        }\r\n    }\r\n}\r\n\r\nfunction drawEnemyRocket(enemy: EnemyRocket, pos: { x: number; y: number; scale: number }): void {\r\n    if (!ctx) return;\r\n\r\n    const w = enemy.width * pos.scale;\r\n    const h = enemy.height * pos.scale;\r\n\r\n    ctx.save();\r\n    ctx.translate(pos.x, pos.y);\r\n    ctx.rotate(Math.PI); // Face down\r\n\r\n    // Enemy rocket body\r\n    ctx.shadowBlur = 15;\r\n    ctx.shadowColor = '#ff0000';\r\n    ctx.fillStyle = '#cc2222';\r\n    ctx.beginPath();\r\n    ctx.moveTo(0, -h / 2);\r\n    ctx.lineTo(w / 3, h / 3);\r\n    ctx.lineTo(-w / 3, h / 3);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n\r\n    // Cockpit\r\n    ctx.fillStyle = '#222222';\r\n    ctx.beginPath();\r\n    ctx.arc(0, 0, w / 5, 0, Math.PI * 2);\r\n    ctx.fill();\r\n\r\n    // Engine glow\r\n    ctx.fillStyle = 'rgba(255, 100, 50, 0.8)';\r\n    ctx.beginPath();\r\n    ctx.moveTo(-w / 5, h / 3);\r\n    ctx.lineTo(0, h / 2 + Math.random() * 5);\r\n    ctx.lineTo(w / 5, h / 3);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n\r\n    ctx.restore();\r\n\r\n    // HP bar\r\n    const barWidth = w * 0.8;\r\n    const barHeight = 4;\r\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';\r\n    ctx.fillRect(pos.x - barWidth / 2, pos.y - h / 2 - 10, barWidth, barHeight);\r\n    ctx.fillStyle = '#ff4444';\r\n    ctx.fillRect(pos.x - barWidth / 2, pos.y - h / 2 - 10, barWidth * (enemy.hp / enemy.maxHp), barHeight);\r\n}\r\n\r\nfunction checkEnemyRocketCollision(): boolean {\r\n    if (!player) return false;\r\n\r\n    for (let i = enemyRockets.length - 1; i >= 0; i--) {\r\n        const enemy = enemyRockets[i];\r\n        if (enemy.z > 0.85) {\r\n            const dist = Math.sqrt(\r\n                Math.pow(player.x - enemy.x, 2) +\r\n                Math.pow(player.y - enemy.y, 2)\r\n            );\r\n            const size = enemy.width * (0.2 + enemy.z * 0.8);\r\n            if (dist < (player.width / 2 + size / 2) * 0.6) {\r\n                enemyRockets.splice(i, 1);\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\n// ============ POWER-UP LOGIC ============\r\n\r\nfunction spawnScatteredPowerUps(): void {\r\n    if (!canvas) return;\r\n\r\n    // Power-ups spawn from top at different times (staggered)\r\n    const lanePositions = [\r\n        canvas.width * 0.25,   // Left lane\r\n        canvas.width * 0.5,    // Center lane  \r\n        canvas.width * 0.75    // Right lane\r\n    ];\r\n    const startZ = [0.1, 0.2, 0.3]; // Staggered start - NOT all at once\r\n    const weaponTypes: WeaponType[] = ['magnetic', 'spread', 'laser'];\r\n    const colors: Record<WeaponType, string> = {\r\n        'spread': '#ff6b6b',\r\n        'laser': '#00d4ff',\r\n        'magnetic': '#9d4edd'\r\n    };\r\n\r\n    weaponTypes.forEach((weaponType, index) => {\r\n        powerUps.push({\r\n            id: powerUpIdCounter++,\r\n            x: lanePositions[index],\r\n            y: -50 - (index * 150), // Start above screen, staggered\r\n            z: startZ[index],\r\n            width: 45,\r\n            height: 45,\r\n            weaponType,\r\n            color: colors[weaponType],\r\n            rotation: 0,\r\n            laneX: 0\r\n        });\r\n    });\r\n}\r\n\r\nfunction updatePowerUps(): void {\r\n    if (!ctx || !canvas || !player) return;\r\n\r\n    for (let i = powerUps.length - 1; i >= 0; i--) {\r\n        const powerUp = powerUps[i];\r\n        powerUp.rotation += 0.03;\r\n\r\n        // Fall from top to bottom (natural drop)\r\n        powerUp.y += 3; // Fall speed\r\n\r\n        const dist = Math.sqrt(\r\n            Math.pow(player.x - powerUp.x, 2) +\r\n            Math.pow(player.y - powerUp.y, 2)\r\n        );\r\n\r\n        // Collect if close enough\r\n        if (dist < 55) {\r\n            equipWeapon(powerUp.weaponType);\r\n            audioManager.playSoundEffect('powerup');\r\n            powerUps.length = 0;\r\n            return;\r\n        }\r\n\r\n        // Remove if fell off screen\r\n        if (powerUp.y > canvas.height + 50) {\r\n            powerUps.splice(i, 1);\r\n            continue;\r\n        }\r\n\r\n        // Draw power-up with simple scale\r\n        const scale = 1.0;\r\n        drawPowerUp(powerUp, { x: powerUp.x, y: powerUp.y, scale });\r\n    }\r\n}\r\n\r\nfunction equipWeapon(weaponType: WeaponType): void {\r\n    // Set as secondary weapon (player keeps spread as base weapon)\r\n    secondaryWeapon = weaponType;\r\n    isFiring = true;\r\n\r\n    // Initialize Timer when getting secondary weapon\r\n    secondaryWeaponEndTime = Date.now() + WEAPON_DURATION;\r\n\r\n    const weaponConfigs: Record<WeaponType, WeaponConfig> = {\r\n        'magnetic': {\r\n            type: 'magnetic',\r\n            fireRate: 150,\r\n            bulletSpeed: 12,\r\n            bulletWidth: 10,\r\n            bulletHeight: 20,\r\n            damage: 50,\r\n            color: '#9d4edd',\r\n            isAutoFire: true\r\n        },\r\n        'spread': {\r\n            type: 'spread',\r\n            fireRate: 180,\r\n            bulletSpeed: 14,\r\n            bulletWidth: 6,\r\n            bulletHeight: 15,\r\n            damage: 80,\r\n            color: '#ff6b6b',\r\n            spreadCount: 3,\r\n            isAutoFire: true\r\n        },\r\n        'laser': {\r\n            type: 'laser',\r\n            fireRate: 50,\r\n            bulletSpeed: 18,\r\n            bulletWidth: 8,\r\n            bulletHeight: 35,\r\n            damage: 100,\r\n            color: '#00d4ff',\r\n            isAutoFire: true\r\n        }\r\n    };\r\n\r\n    secondaryWeaponConfig = weaponConfigs[weaponType];\r\n    updateUI();\r\n}\r\n\r\nfunction drawPowerUp(powerUp: PowerUp, pos: { x: number; y: number; scale: number }): void {\r\n    if (!ctx) return;\r\n\r\n    ctx.save();\r\n    ctx.translate(pos.x, pos.y);\r\n    ctx.scale(pos.scale, pos.scale);\r\n    ctx.rotate(powerUp.rotation);\r\n\r\n    ctx.shadowBlur = 20;\r\n    ctx.shadowColor = powerUp.color;\r\n\r\n    ctx.fillStyle = powerUp.color;\r\n    ctx.beginPath();\r\n    ctx.moveTo(0, -22);\r\n    ctx.lineTo(22, 0);\r\n    ctx.lineTo(0, 22);\r\n    ctx.lineTo(-22, 0);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n\r\n    ctx.fillStyle = '#ffffff';\r\n    ctx.beginPath();\r\n    ctx.moveTo(0, -10);\r\n    ctx.lineTo(10, 0);\r\n    ctx.lineTo(0, 10);\r\n    ctx.lineTo(-10, 0);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n\r\n    ctx.restore();\r\n}\r\n\r\n// ============ BULLET LOGIC - STRAIGHT UP ============\r\n\r\nfunction fireBullets(): void {\r\n    if (!player || !canvas || !weaponConfig || !hasWeapon) return;\r\n\r\n    const baseX = player.x;\r\n    const baseY = player.y - player.height / 2;\r\n\r\n    // Always fire base weapon (spread)\r\n    const spreadCount = weaponConfig.spreadCount || 3;\r\n    const angleSpread = 0.15;\r\n\r\n    for (let i = 0; i < spreadCount; i++) {\r\n        const angleOffset = (i - (spreadCount - 1) / 2) * angleSpread;\r\n        bullets.push({\r\n            id: bulletIdCounter++,\r\n            x: baseX,\r\n            y: baseY,\r\n            z: 1,\r\n            width: weaponConfig.bulletWidth,\r\n            height: weaponConfig.bulletHeight,\r\n            speed: weaponConfig.bulletSpeed,\r\n            damage: weaponConfig.damage,\r\n            color: weaponConfig.color,\r\n            type: 'spread',\r\n            angle: angleOffset\r\n        });\r\n    }\r\n    audioManager.playSoundEffect('spread');\r\n\r\n    // If player has caught a secondary weapon, fire it too\r\n    if (secondaryWeapon && secondaryWeaponConfig) {\r\n        if (secondaryWeaponConfig.type === 'laser') {\r\n            bullets.push({\r\n                id: bulletIdCounter++,\r\n                x: baseX,\r\n                y: baseY,\r\n                z: 1,\r\n                width: secondaryWeaponConfig.bulletWidth,\r\n                height: secondaryWeaponConfig.bulletHeight,\r\n                speed: secondaryWeaponConfig.bulletSpeed,\r\n                damage: secondaryWeaponConfig.damage,\r\n                color: secondaryWeaponConfig.color,\r\n                type: 'laser'\r\n            });\r\n            audioManager.playSoundEffect('laser');\r\n        } else if (secondaryWeaponConfig.type === 'magnetic') {\r\n            const targetResult = findNearestTarget(baseX, baseY);\r\n            bullets.push({\r\n                id: bulletIdCounter++,\r\n                x: baseX,\r\n                y: baseY,\r\n                z: 1,\r\n                width: secondaryWeaponConfig.bulletWidth,\r\n                height: secondaryWeaponConfig.bulletHeight,\r\n                speed: secondaryWeaponConfig.bulletSpeed,\r\n                damage: secondaryWeaponConfig.damage,\r\n                color: secondaryWeaponConfig.color,\r\n                type: 'magnetic',\r\n                targetAsteroid: targetResult.target as MovingAsteroid || undefined\r\n            });\r\n            audioManager.playSoundEffect('magnetic');\r\n        } else if (secondaryWeaponConfig.type === 'spread') {\r\n            // If secondary is also spread, fire additional spread shots at different angles\r\n            const secondarySpreadCount = secondaryWeaponConfig.spreadCount || 3;\r\n            const secondaryAngleSpread = 0.25; // Wider angle for secondary spread\r\n\r\n            for (let i = 0; i < secondarySpreadCount; i++) {\r\n                const angleOffset = (i - (secondarySpreadCount - 1) / 2) * secondaryAngleSpread;\r\n                bullets.push({\r\n                    id: bulletIdCounter++,\r\n                    x: baseX,\r\n                    y: baseY,\r\n                    z: 1,\r\n                    width: secondaryWeaponConfig.bulletWidth,\r\n                    height: secondaryWeaponConfig.bulletHeight,\r\n                    speed: secondaryWeaponConfig.bulletSpeed,\r\n                    damage: secondaryWeaponConfig.damage,\r\n                    color: '#ffaa00', // Different color for secondary spread\r\n                    type: 'spread',\r\n                    angle: angleOffset\r\n                });\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction findNearestTarget(x: number, y: number): { target: MovingAsteroid | EnemyRocket | null, isRocket: boolean } {\r\n    let nearest: MovingAsteroid | EnemyRocket | null = null;\r\n    let minDist = Infinity;\r\n    let isRocket = false;\r\n\r\n    // Check moving asteroids\r\n    for (const asteroid of movingAsteroids) {\r\n        const dx = asteroid.x - x;\r\n        const dy = asteroid.y - y;\r\n        const dist = Math.sqrt(dx * dx + dy * dy);\r\n        if (dist < minDist) {\r\n            minDist = dist;\r\n            nearest = asteroid;\r\n            isRocket = false;\r\n        }\r\n    }\r\n\r\n    // Check enemy rockets\r\n    for (const enemy of enemyRockets) {\r\n        const dx = enemy.x - x;\r\n        const dy = enemy.y - y;\r\n        const dist = Math.sqrt(dx * dx + dy * dy);\r\n        if (dist < minDist) {\r\n            minDist = dist;\r\n            nearest = enemy;\r\n            isRocket = true;\r\n        }\r\n    }\r\n\r\n    return { target: nearest, isRocket };\r\n}\r\n\r\nfunction updateBullets(): void {\r\n    if (!ctx || !canvas) return;\r\n\r\n    for (let i = bullets.length - 1; i >= 0; i--) {\r\n        const bullet = bullets[i];\r\n\r\n        // Move bullet STRAIGHT UP (decreasing Y and Z)\r\n        bullet.y -= bullet.speed;\r\n        bullet.z -= 0.02;\r\n\r\n        if (bullet.type === 'spread' && bullet.angle !== undefined) {\r\n            bullet.x += Math.sin(bullet.angle) * bullet.speed * 0.4;\r\n        }\r\n\r\n        // Magnetic bullet homes in on target (asteroid or enemy rocket) - closer range\r\n        if (bullet.type === 'magnetic' && player) {\r\n            // Find nearest target within closer range to player (300 pixels)\r\n            const targetResult = findNearestTarget(player.x, player.y);\r\n            const target = targetResult.target;\r\n\r\n            if (target) {\r\n                const playerDist = Math.sqrt(\r\n                    Math.pow(target.x - player.x, 2) +\r\n                    Math.pow(target.y - player.y, 2)\r\n                );\r\n\r\n                // Only home in if target is within 300 pixels of player\r\n                if (playerDist < 300) {\r\n                    const dx = target.x - bullet.x;\r\n                    const dy = target.y - bullet.y;\r\n                    const dist = Math.sqrt(dx * dx + dy * dy);\r\n                    if (dist > 0) {\r\n                        // Move DIRECTLY towards target (full homing)\r\n                        bullet.x += (dx / dist) * bullet.speed;\r\n                        bullet.y += (dy / dist) * bullet.speed;\r\n                        // Override the default upward movement\r\n                        bullet.y += bullet.speed;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Check collision with moving asteroids\r\n        let bulletHit = false;\r\n        for (let j = movingAsteroids.length - 1; j >= 0; j--) {\r\n            const asteroid = movingAsteroids[j];\r\n            const size = asteroid.baseSize;\r\n            const dist = Math.sqrt(\r\n                Math.pow(bullet.x - asteroid.x, 2) +\r\n                Math.pow(bullet.y - asteroid.y, 2)\r\n            );\r\n\r\n            if (dist < size) {\r\n                asteroid.hp -= bullet.damage;\r\n                asteroid.hitFlash = 10;\r\n                gameStats.hits++;\r\n\r\n                if (hasWeapon) {\r\n                    gameStats.score += 100;\r\n                }\r\n                updateUI();\r\n\r\n                if (asteroid.hp <= 0) {\r\n                    gameStats.asteroidsDestroyed++;\r\n                    if (asteroid.isBoss) {\r\n                        gameStats.bossDestroyed = true;\r\n                    }\r\n                    // Spawn explosion effect\r\n                    spawnExplosion(asteroid.x, asteroid.y, asteroid.isBoss ? 2 : 1);\r\n                    movingAsteroids.splice(j, 1);\r\n                    audioManager.playSoundEffect('explosion');\r\n                }\r\n\r\n                bulletHit = true;\r\n                break;\r\n            }\r\n        }\r\n\r\n        // Check collision with enemy rockets\r\n        if (!bulletHit) {\r\n            for (let j = enemyRockets.length - 1; j >= 0; j--) {\r\n                const enemy = enemyRockets[j];\r\n                const size = enemy.width;\r\n                const dist = Math.sqrt(\r\n                    Math.pow(bullet.x - enemy.x, 2) +\r\n                    Math.pow(bullet.y - enemy.y, 2)\r\n                );\r\n\r\n                if (dist < size) {\r\n                    enemy.hp -= bullet.damage;\r\n                    gameStats.hits++;\r\n\r\n                    if (hasWeapon) {\r\n                        gameStats.score += 150; // More points for enemy rockets\r\n                    }\r\n                    updateUI();\r\n\r\n                    if (enemy.hp <= 0) {\r\n                        // Spawn explosion effect\r\n                        spawnExplosion(enemy.x, enemy.y, 1.2);\r\n                        enemyRockets.splice(j, 1);\r\n                        audioManager.playSoundEffect('explosion');\r\n                    }\r\n\r\n                    bulletHit = true;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n\r\n        // Check collision with boss rocket\r\n        if (!bulletHit && bossRocket) {\r\n            const dist = Math.sqrt(\r\n                Math.pow(bullet.x - bossRocket.x, 2) +\r\n                Math.pow(bullet.y - bossRocket.y, 2)\r\n            );\r\n\r\n            if (dist < bossRocket.width * 0.4) {\r\n                bossRocket.hp -= bullet.damage;\r\n                gameStats.hits++;\r\n\r\n                if (hasWeapon) {\r\n                    gameStats.score += 500; // Big points for hitting boss\r\n                }\r\n                updateUI();\r\n\r\n                if (bossRocket.hp <= 0) {\r\n                    // Boss destroyed!\r\n                    spawnExplosion(bossRocket.x, bossRocket.y, 3.0);\r\n                    gameStats.bossDestroyed = true;\r\n                    gameStats.score += 5000; // Huge bonus for destroying boss\r\n                    bossRocket = null;\r\n                    audioManager.playSoundEffect('explosion');\r\n                }\r\n\r\n                bulletHit = true;\r\n            }\r\n        }\r\n\r\n        if (bulletHit || bullet.y < -50 || bullet.z < 0.05) {\r\n            bullets.splice(i, 1);\r\n            continue;\r\n        }\r\n\r\n        drawBullet(bullet);\r\n    }\r\n}\r\n\r\nfunction drawBullet(bullet: Bullet): void {\r\n    if (!ctx) return;\r\n\r\n    ctx.save();\r\n    ctx.shadowBlur = 20;\r\n    ctx.shadowColor = bullet.color;\r\n\r\n    // Larger bullet sizes (3x width, 2x height)\r\n    const drawWidth = bullet.width * 3;\r\n    const drawHeight = bullet.height * 2;\r\n\r\n    if (bullet.type === 'magnetic') {\r\n        // Purple magnetic bullet image\r\n        if (bulletMagneticImage && bulletMagneticImage.complete) {\r\n            ctx.drawImage(bulletMagneticImage, bullet.x - drawWidth / 2, bullet.y - drawHeight / 2, drawWidth, drawHeight);\r\n        } else {\r\n            ctx.fillStyle = bullet.color;\r\n            ctx.beginPath();\r\n            ctx.arc(bullet.x, bullet.y, bullet.width / 2, 0, Math.PI * 2);\r\n            ctx.fill();\r\n        }\r\n    } else if (bullet.type === 'laser') {\r\n        // Blue laser bullet image\r\n        if (bulletLaserImage && bulletLaserImage.complete) {\r\n            ctx.drawImage(bulletLaserImage, bullet.x - drawWidth / 2, bullet.y - drawHeight / 2, drawWidth, drawHeight);\r\n        } else {\r\n            ctx.fillStyle = bullet.color;\r\n            ctx.fillRect(bullet.x - bullet.width / 2, bullet.y - bullet.height / 2, bullet.width, bullet.height);\r\n        }\r\n    } else {\r\n        // Orange spread bullet image\r\n        if (bulletSpreadImage && bulletSpreadImage.complete) {\r\n            ctx.drawImage(bulletSpreadImage, bullet.x - drawWidth / 2, bullet.y - drawHeight / 2, drawWidth, drawHeight);\r\n        } else {\r\n            ctx.fillStyle = bullet.color;\r\n            ctx.fillRect(bullet.x - bullet.width / 2, bullet.y - bullet.height / 2, bullet.width, bullet.height);\r\n        }\r\n    }\r\n\r\n    ctx.restore();\r\n}\r\n\r\n// ============ PLAYER ============\r\n\r\nfunction drawPlayer(): void {\r\n    if (!ctx || !player) return;\r\n\r\n    ctx.save();\r\n\r\n    // Flashing effect when immune\r\n    if (isImmune) {\r\n        const flashRate = Math.floor(Date.now() / 100) % 2;\r\n        if (flashRate === 0) {\r\n            ctx.globalAlpha = 0.4;\r\n        }\r\n        // Cyan glow for immunity\r\n        ctx.shadowBlur = 30;\r\n        ctx.shadowColor = '#00ffff';\r\n    }\r\n\r\n    if (player.image.complete) {\r\n        ctx.translate(player.x, player.y);\r\n        ctx.rotate(player.tilt * Math.PI / 180);\r\n\r\n        if (!isImmune) {\r\n            ctx.shadowBlur = 20;\r\n            ctx.shadowColor = hasWeapon && weaponConfig ? weaponConfig.color : '#00d4ff';\r\n        }\r\n\r\n        ctx.drawImage(\r\n            player.image,\r\n            -player.width / 2,\r\n            -player.height / 2,\r\n            player.width,\r\n            player.height\r\n        );\r\n    }\r\n\r\n    ctx.restore();\r\n}\r\n\r\n// ============ WIN CONDITION ============\r\n\r\nfunction checkWinCondition(): boolean {\r\n    // Win condition: Boss must be destroyed (bossSpawned but bossRocket is null means destroyed)\r\n    if (!bossSpawned) {\r\n        // Boss hasn't spawned yet, keep playing\r\n        return false;\r\n    }\r\n\r\n    // Boss was spawned and destroyed (bossRocket is null after being spawned)\r\n    if (bossRocket === null) {\r\n        // Boss destroyed! Player wins\r\n        return true;\r\n    }\r\n\r\n    // Boss still alive, keep fighting\r\n    return false;\r\n}\r\n\r\n// ============ UI ============\r\n\r\nfunction updateUI(): void {\r\n    const scoreEl = document.getElementById('game-score');\r\n    const hpEl = document.getElementById('player-hp-text');\r\n\r\n    if (scoreEl) scoreEl.textContent = String(gameStats.score);\r\n    if (hpEl && player) hpEl.textContent = `${player.hp}/${player.maxHp}`;\r\n}\r\n\r\n// ============ END GAME ============\r\n\r\nfunction endGame(): void {\r\n    isGameRunning = false;\r\n\r\n    if (gameLoop) {\r\n        cancelAnimationFrame(gameLoop);\r\n        gameLoop = null;\r\n    }\r\n\r\n    if (mouseMoveHandler) document.removeEventListener('mousemove', mouseMoveHandler);\r\n    if (keyDownHandler) document.removeEventListener('keydown', keyDownHandler);\r\n    if (keyUpHandler) document.removeEventListener('keyup', keyUpHandler);\r\n    if (mouseDownHandler) document.removeEventListener('mousedown', mouseDownHandler);\r\n    if (mouseUpHandler) document.removeEventListener('mouseup', mouseUpHandler);\r\n\r\n    if (!ctx || !canvas) {\r\n        if (onComplete && !callbackCalled) {\r\n            callbackCalled = true;\r\n            onComplete(gameStats);\r\n        }\r\n        return;\r\n    }\r\n\r\n    ctx.fillStyle = 'rgba(5, 8, 20, 0.9)';\r\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n\r\n    ctx.font = 'bold 55px Orbitron, sans-serif';\r\n    ctx.textAlign = 'center';\r\n    ctx.textBaseline = 'middle';\r\n\r\n    if (gameStats.success) {\r\n        ctx.fillStyle = '#06ffa5';\r\n        ctx.fillText('VICTORY!', canvas.width / 2, canvas.height / 2 - 55);\r\n    } else {\r\n        ctx.fillStyle = '#ff006e';\r\n        ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 55);\r\n    }\r\n\r\n    ctx.font = '26px Space Mono, monospace';\r\n    ctx.fillStyle = '#b8c1ec';\r\n    ctx.fillText(`Score: ${gameStats.score}`, canvas.width / 2, canvas.height / 2 + 15);\r\n    ctx.fillText(`Destroyed: ${gameStats.asteroidsDestroyed}`, canvas.width / 2, canvas.height / 2 + 50);\r\n\r\n    ctx.font = '18px Space Mono, monospace';\r\n    ctx.fillStyle = '#00d4ff';\r\n    ctx.fillText('Continuing...', canvas.width / 2, canvas.height / 2 + 100);\r\n\r\n    setTimeout(() => {\r\n        if (onComplete && !callbackCalled) {\r\n            callbackCalled = true;\r\n            onComplete(gameStats);\r\n        }\r\n    }, 3000);\r\n}\r\n\r\nexport function cleanupMiniGame(): void {\r\n    isGameRunning = false;\r\n\r\n    if (gameLoop) {\r\n        cancelAnimationFrame(gameLoop);\r\n        gameLoop = null;\r\n    }\r\n\r\n    if (mouseMoveHandler) document.removeEventListener('mousemove', mouseMoveHandler);\r\n    if (keyDownHandler) document.removeEventListener('keydown', keyDownHandler);\r\n    if (keyUpHandler) document.removeEventListener('keyup', keyUpHandler);\r\n    if (mouseDownHandler) document.removeEventListener('mousedown', mouseDownHandler);\r\n    if (mouseUpHandler) document.removeEventListener('mouseup', mouseUpHandler);\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2656, "column": 0}, "map": {"version":3,"sources":["file:///E:/deadline-2days/space-quiz-mission%20-%20Final%20-%20Copy%20%287%29%20-%20Copy/app/join/game/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useCallback } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useGame } from '@/context/GameContext';\r\nimport { startMiniGame, cleanupMiniGame, GameStats } from '@/lib/miniGame';\r\n\r\nexport default function GamePage(): React.JSX.Element {\r\n    const router = useRouter();\r\n    const { gameState, setGameState, showLoading, hideLoading } = useGame();\r\n\r\n    const handleGameComplete = useCallback((stats: GameStats): void => {\r\n        setGameState(prev => ({\r\n            ...prev,\r\n            miniGamesCompleted: stats.success ? prev.miniGamesCompleted + 1 : prev.miniGamesCompleted,\r\n            score: prev.score + stats.score,\r\n            gameStats: {\r\n                hits: stats.hits,\r\n                asteroidsDestroyed: stats.asteroidsDestroyed,\r\n                gameScore: stats.score,\r\n                bossDestroyed: stats.bossDestroyed,\r\n                success: stats.success\r\n            },\r\n            isEliminated: stats.isEliminated\r\n        }));\r\n\r\n        showLoading();\r\n        setTimeout(() => {\r\n            // If player is eliminated, go directly to results\r\n            if (stats.isEliminated) {\r\n                router.push('/join/results');\r\n            } else if (gameState.currentQuestionIndex < gameState.selectedQuestions) {\r\n                router.push('/join/quiz');\r\n            } else {\r\n                router.push('/join/results');\r\n            }\r\n            hideLoading();\r\n        }, 500);\r\n    }, [gameState.currentQuestionIndex, gameState.selectedQuestions, router, setGameState, showLoading, hideLoading]);\r\n\r\n    useEffect(() => {\r\n        if (!gameState.selectedSpaceship) {\r\n            router.push('/join/hangar');\r\n            return;\r\n        }\r\n\r\n        const initTimeout = setTimeout(() => {\r\n            if (gameState.selectedSpaceship) {\r\n                startMiniGame(\r\n                    gameState.selectedSpaceship,\r\n                    gameState.selectedDifficulty,\r\n                    handleGameComplete\r\n                );\r\n            }\r\n        }, 600);\r\n\r\n        return () => {\r\n            clearTimeout(initTimeout);\r\n            cleanupMiniGame();\r\n        };\r\n    }, [gameState.selectedSpaceship, gameState.selectedDifficulty, handleGameComplete, router]);\r\n\r\n    return (\r\n        <section id=\"screen-minigame\" className=\"screen active game-fullscreen\">\r\n            <canvas id=\"minigame-canvas\"></canvas>\r\n        </section>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAOe,SAAS;IACpB,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,EAAE,SAAS,EAAE,YAAY,EAAE,WAAW,EAAE,WAAW,EAAE,GAAG,IAAA,kIAAO;IAErE,MAAM,qBAAqB,IAAA,oNAAW,EAAC,CAAC;QACpC,aAAa,CAAA,OAAQ,CAAC;gBAClB,GAAG,IAAI;gBACP,oBAAoB,MAAM,OAAO,GAAG,KAAK,kBAAkB,GAAG,IAAI,KAAK,kBAAkB;gBACzF,OAAO,KAAK,KAAK,GAAG,MAAM,KAAK;gBAC/B,WAAW;oBACP,MAAM,MAAM,IAAI;oBAChB,oBAAoB,MAAM,kBAAkB;oBAC5C,WAAW,MAAM,KAAK;oBACtB,eAAe,MAAM,aAAa;oBAClC,SAAS,MAAM,OAAO;gBAC1B;gBACA,cAAc,MAAM,YAAY;YACpC,CAAC;QAED;QACA,WAAW;YACP,kDAAkD;YAClD,IAAI,MAAM,YAAY,EAAE;gBACpB,OAAO,IAAI,CAAC;YAChB,OAAO,IAAI,UAAU,oBAAoB,GAAG,UAAU,iBAAiB,EAAE;gBACrE,OAAO,IAAI,CAAC;YAChB,OAAO;gBACH,OAAO,IAAI,CAAC;YAChB;YACA;QACJ,GAAG;IACP,GAAG;QAAC,UAAU,oBAAoB;QAAE,UAAU,iBAAiB;QAAE;QAAQ;QAAc;QAAa;KAAY;IAEhH,IAAA,kNAAS,EAAC;QACN,IAAI,CAAC,UAAU,iBAAiB,EAAE;YAC9B,OAAO,IAAI,CAAC;YACZ;QACJ;QAEA,MAAM,cAAc,WAAW;YAC3B,IAAI,UAAU,iBAAiB,EAAE;gBAC7B,IAAA,gIAAa,EACT,UAAU,iBAAiB,EAC3B,UAAU,kBAAkB,EAC5B;YAER;QACJ,GAAG;QAEH,OAAO;YACH,aAAa;YACb,IAAA,kIAAe;QACnB;IACJ,GAAG;QAAC,UAAU,iBAAiB;QAAE,UAAU,kBAAkB;QAAE;QAAoB;KAAO;IAE1F,qBACI,8OAAC;QAAQ,IAAG;QAAkB,WAAU;kBACpC,cAAA,8OAAC;YAAO,IAAG;;;;;;;;;;;AAGvB","debugId":null}}]
}